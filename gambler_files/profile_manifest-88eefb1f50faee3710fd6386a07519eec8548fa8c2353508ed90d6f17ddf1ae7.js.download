(function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes"),Strava.Athletes.EditPersonalRecordsLightboxView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.initialize=function(t,e){return this.lightbox=new Strava.Ui.LightboxView("edit_personal_records"),this.editPersonalRecordsView=new Strava.Athletes.EditPersonalRecordsView(t,e)},r.prototype.render=function(){return this.lightbox.renderWithRenderer(this.editPersonalRecordsView),this.editPersonalRecordsView.editPersonalRecord(),this},r.prototype.close=function(){return this.lightbox.closeBox()},r.show=function(t,e){return this.instance=new Strava.Athletes.EditPersonalRecordsLightboxView(t,e),this.instance.render()},r}(Backbone.View)}).call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes"),Strava.Athletes.EditPersonalRecordsView=function(e){function r(t,e){this.template="personal_records/lightbox_content",this.personalRecords=t,this.personalRecordToEdit=e,this.personalRecords.bind("add",function(t){return function(){return t.render()}}(this)),r.__super__.constructor.call(this)}return t(r,e),r.prototype.className="edit-personal-records marginless",r.prototype.render=function(){return this.renderTemplate({}),this.editPersonalRecordViews=[],this.personalRecords.forEach(function(t){return function(e){var r;return r=new Strava.Athletes.EditPersonalRecordView(e),r.bind("showForm",function(){return t.hideOtherPersonalRecordViews(r)}),t.$el.find("tbody").append(r.render().el),t.editPersonalRecordViews.push(r)}}(this)),this},r.prototype.editPersonalRecord=function(){return null!=this.personalRecordToEdit?this.editPersonalRecordViews.forEach(function(t){return function(e){return t.personalRecordToEdit===e.personalRecord?e.showForm():void 0}}(this)):void 0},r.prototype.hideOtherPersonalRecordViews=function(t){return this.editPersonalRecordViews.forEach(function(e){return e!==t?e.closeForm():void 0})},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes"),Strava.Athletes.EditPersonalRecordView=function(e){function r(t){this.template="personal_records/edit",this.personalRecord=t,this.personalRecord.bind("change",function(t){return function(){return t.render(),t.showSavedConfirmation()}}(this)),r.__super__.constructor.call(this)}return t(r,e),r.prototype.tagName="tr",r.prototype.events={"click td .delete":"deletePersonalRecord","click td":"showForm","click form .cancel":"closeForm","click form .save":"savePersonalRecord"},r.prototype.render=function(){return this.renderTemplate({personalRecord:this.personalRecord}),jQuery.validator.addMethod("stravaActivityUrl",function(){return function(t){return t?Strava.Athletes.PersonalRecord.parseActivityUrl(t):!0}}(this),Strava.I18n.Locale.t("strava.athletes.edit_personal_record.please_enter_url")),this.$("form").validate({errorElement:"em",onfocusout:!1,rules:{pr_time_sec:{required:!0,number:!0,min:0,max:59},pr_time_min:{required:!0,number:!0,min:0,max:59},pr_time_hr:{number:!0,min:0,max:70},pr_activity:{stravaActivityUrl:!0},pr_results:{url:!0}},messages:{pr_time_sec:"",pr_time_min:"",pr_time_hr:"",pr_activity:""}}),this},r.prototype.showSavedConfirmation=function(){var t;return this.$el.addClass("saved"),t=function(t){return function(){return t.$el.removeClass("saved")}}(this),setTimeout(t,2e3)},r.prototype.showForm=function(){return this.$el.addClass("editable-row"),this.$("td.readonly-column").hide(),this.$("td.editable-column").show(),this.trigger("showForm")},r.prototype.closeForm=function(){return this.$el.removeClass("editable-row"),this.$("td.editable-column").hide(),this.$("td.readonly-column").show(),!1},r.prototype.savePersonalRecord=function(){var t,e,r,o,n;if(this.$("form").valid())return this.closeForm(),n=this.$("input[name='pr_time_sec']").val(),e=this.$("input[name='pr_time_min']").val(),t=this.$("input[name='pr_time_hr']").val(),r=this.$("input[name='pr_activity']").val(),o=this.$("input[name='pr_results']").val(),this.personalRecord.setElapsedTime(t,e,n),this.personalRecord.setStravaActivity(r),this.personalRecord.set({results:o}),this.personalRecord.save({},{wait:!0}),!1},r.prototype.deletePersonalRecord=function(){return confirm(Strava.I18n.Locale.t("strava.athletes.edit_personal_record.are_you_sure"))?this.personalRecord.destroy({wait:!0}):void 0},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava"),Strava.base_module={initializeAttributes:function(t){var e,r,o;r=[];for(e in t)o=t[e],r.push(this.initAttribute(e,o));return r},setOrGet:function(t,e){return void 0!==e?(this[t]=e,this):this[t]},initAttribute:function(t,e){var r;return this.constructor.prototype[t]=function(t){return this.setOrGet(r,t)},r="_"+t,this[r]=!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor?e:_.clone(e)},create_template:function(t){var e;return e=jQuery(t),this.template=_.template(e.html())},create_template_for:function(t){var e;return e=jQuery(t),_.template(e.html())}},Strava.chart_module={shouldAnimate:function(t){return null!=this.animate()?this.animate():t}},Strava.local_storage_module={initializeStorageAttributes:function(t,e,r){var o,n,a;null==r&&(r=!1),r&&this.setLocalStorage(e,{}),n=[];for(o in t)a=t[o],n.push(this.initStorageAttribute(o,a,e));return n},getLocalStorage:function(t){var e;return e=localStorage[t],e?JSON.parse(localStorage[t])||{}:{}},setLocalStorage:function(t,e){return localStorage[t]=JSON.stringify(e)},setOrGetStorage:function(t,e,r){var o;return o=this.getLocalStorage(r),void 0!==e?(o[t]=e,this.setLocalStorage(r,o),this):o[t]},initStorageAttribute:function(t,e,r){var o,n;if(this.constructor.prototype[t]=function(t){return this.setOrGetStorage(o,t,r)},o="_"+t,!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor)return n=this.setOrGetStorage(o,void 0,r),void 0!==n&&(e=n),this.setOrGetStorage(o,e,r);throw new Error("cannot store non-primitive types in localstorage")}},Strava.Base=function(){function t(){}return Strava.includeModule(t,Backbone.Events),Strava.includeModule(t,Strava.base_module),t.prototype.$=function(t,e){return e.find(t)},t.prototype.$$=function(t){return jQuery(t)},t.prototype.$document=function(){return jQuery(document)},t.prototype.one=function(t,e,r){var o,n,a,i;return i=this,o=e,n=t,a=function(){return o.call(this),i.unbind(n,a)},this.bind(t,a,r)},t.prototype.createHandler=function(t){return function(){var e;return e=Array.prototype.slice.call(arguments),e.unshift(this),t.apply(null,e)}},t.prototype.isTouchDevice=function(){return Modernizr?Modernizr.touch:!1},t}(),Strava.Controller=function(e){function r(){r.__super__.constructor.call(this)}return t(r,e),Strava.includeModule(r,Strava.base_module),r.prototype.parse=function(){return{id:0}},r}(Backbone.Model)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes"),Strava.Athletes.PersonalRecord=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.ACTIVITY_URL_REGEXP=/strava.com\/activities\/([0-9]+)/,r.prototype.getHoursMinutesSeconds=function(){var t,e,r,o,n;return t=this.get("elapsed_time"),r=[],t?(e=Math.floor(t/3600).toString(),r.push(e),t-=3600*e,o=Math.floor(t/60),10>o&&e>0&&(o="0"+o),r.push(o.toString()),n=Math.floor(t-60*r[1]),10>n&&(n="0"+n),r.push(n.toString()),r):["","",""]},r.prototype.setElapsedTime=function(t,e,r){var o;return o=0,r&&(this.set({elapsed_time_sec:r}),r&&(o+=parseInt(r))),e&&(this.set({elapsed_time_min:e}),o+=60*parseInt(e)),t&&(this.set({elapsed_time_hrs:t}),o+=3600*parseInt(t)),this.set({elapsed_time:o})},r.prototype.setStravaActivity=function(t){var e;return this.set({activity_url:t}),e=r.parseActivityUrl(t),e?this.set({activity_id:e}):void 0},r.parseActivityUrl=function(t){var e;return t?(e=r.ACTIVITY_URL_REGEXP.exec(t),e&&2===e.length?e[1]:!1):!1},r}(Backbone.Model)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes"),Strava.Athletes.PersonalRecords=function(e){function r(t){r.__super__.constructor.call(this),this.comparator=function(t){return t.get("record_type")},this.athleteId=t,this.deferred=jQuery.Deferred(),this.bind("reset",function(t){return function(){return t.deferred.resolve()}}(this)),this.bind("remove",function(t){return function(e){var r,o;return r=e.get("record_type"),o=new Strava.Athletes.PersonalRecord({record_type:r}),t.add(o)}}(this))}return t(r,e),r.prototype.model=Strava.Athletes.PersonalRecord,r.prototype.url=function(){return"/athletes/"+this.athleteId+"/prs"},r}(Backbone.Collection)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes"),Strava.Athletes.PersonalRecordsView=function(e){function r(t,e){var o;this.athletePersonalRecords=new Strava.Athletes.PersonalRecords(t),this.athletePersonalRecords.bind("destroy",function(t){return function(){return t.render()}}(this)),o=[this.athletePersonalRecords.deferred],this.canEdit=t===e,this.viewerPersonalRecords=null,e!==t&&(this.viewerPersonalRecords=new Strava.Athletes.PersonalRecords(e),o.push(this.viewerPersonalRecords.deferred)),this.template="personal_records/index",jQuery.when.apply(null,o).done(function(t){return function(){return t.render()}}(this)),r.__super__.constructor.call(this)}return t(r,e),r.prototype.events={"click #add-pr":"openLightbox"},r.prototype.fetchModels=function(){return this.athletePersonalRecords.fetch({reset:!0}),this.viewerPersonalRecords?this.viewerPersonalRecords.fetch({reset:!0}):void 0},r.prototype.render=function(){var t;return this.renderTemplate({athletePersonalRecords:this.athletePersonalRecords,viewerPersonalRecords:this.viewerPersonalRecords,canEdit:!this.viewerPersonalRecords}),t=0,this.athletePersonalRecords.forEach(function(e){return function(r){var o,n;return n=e.viewerPersonalRecords?e.viewerPersonalRecords.at(t):null,o=new Strava.Athletes.PersonalRecordView(r,n,e.canEdit),o.bind("edit",function(){return e.openLightbox(r)}),e.canEdit&&r.bind("sync",function(){return e.render()}),o.shouldShow()&&e.$el.append(o.render().el),t++}}(this))},r.prototype.openLightbox=function(t){return Strava.Athletes.EditPersonalRecordsLightboxView.show(this.athletePersonalRecords,t)},r}(Backbone.View)}.call(this),function(){Strava.module("Strava.Athletes"),Strava.Athletes.PersonalRecordTypes=[1500,1609,3e3,3219,5e3,1e4,15e3,16090,2e4,21097,3e4,42195,5e4,80467,1e5,160934]}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Athletes"),Strava.Athletes.PersonalRecordView=function(e){function r(t,e,o){this.athletePersonalRecord=t,this.viewerPersonalRecord=e,this.canEdit=o,this.canEdit&&this.athletePersonalRecord.bind("sync",function(t){return function(){return t.render()}}(this)),this.template="personal_records/row",r.__super__.constructor.call(this)}return t(r,e),r.prototype.tagName="tr",r.prototype.events={"click .viewing .clickable.pr":"showAthleteDetails","click .viewer .clickable.pr":"showViewerDetails"},r.prototype.shouldShow=function(){return this.athletePersonalRecord.get("elapsed_time")||this.viewerPersonalRecord&&this.viewerPersonalRecord.get("elapsed_time")},r.prototype.render=function(){return this.renderTemplate({distance:this.athletePersonalRecord.get("record_type"),athletePersonalRecord:this.athletePersonalRecord,viewerPersonalRecord:this.viewerPersonalRecord}),this},r.prototype.showAthleteDetails=function(t){return this.showDetails(t,this.athletePersonalRecord)},r.prototype.showViewerDetails=function(t){return this.showDetails(t,this.viewerPersonalRecord)},r.prototype.showDetails=function(t,e){var r,o;return r={canEdit:this.canEdit,recordType:e.get("record_type"),results:e.get("results"),activityId:e.get("activity_id"),time:e.get("elapsed_time"),header:Strava.I18n.Locale.t("templates.personal_records.edit.distances."+this.athletePersonalRecord.get("record_type")+"m")},o=new Strava.Ui.TooltipView("personal_records/detail_tooltip"),this.$$(o.el).addClass("all-time-pr"),o.render(r,t.currentTarget),this.$$(o.el).find("a.edit").click(function(t){return function(){return o.dismissTooltip(),t.trigger("edit")}}(this))},r}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["personal_records/detail_tooltip"]=function(t){return function(){var t,e,r;return e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<a class='dismiss'>Dismiss</a>\n<h4 class='h5 title'>"+e(t(this.data.header))+"</h4>\n<div class='content'>\n  <div class='time'>"),r.push("    "+e(t((new Strava.I18n.TimespanFormatter).display(this.data.time)))),this.data.canEdit&&r.push("    <a class='edit sprite'></a>"),r.push("  </div>"),(this.data.activityId||this.data.results)&&(r.push("  <div class='results'>"),this.data.activityId&&r.push("    <a href='http://www.strava.com/activities/"+e(t(this.data.activityId))+"'>"+e(t(Strava.I18n.Locale.t("templates.personal_records.detail_tooltip.strava_activity")))+"</a>"),this.data.results&&r.push("    <a href='"+e(t(this.data.results))+"' target='_blank'>"+t(Strava.I18n.Locale.t("templates.personal_records.detail_tooltip.official_results")+" &rarr;")+"</a>"),r.push("  </div>")),r.push("</div>\n<div class='arrow bottom'></div>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["personal_records/edit"]=function(t){return function(){var t,e,r,o,n;return e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<td>"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.distances."+this.personalRecord.get("record_type")+"m")))+"</td>\n<td class='readonly-column'>"),r.push(this.personalRecord.get("elapsed_time")?"  "+e(t((new Strava.I18n.TimespanFormatter).display(this.personalRecord.get("elapsed_time")))):"  &mdash;"),r.push("</td>\n<td class='readonly-column'>"),r.push(this.personalRecord.get("elapsed_time")?"  <span class='edit'>"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.edit_personal_record")))+"</span>\n  <span class='clickable delete float-right'>"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.remove")))+"</span>":"  <span class='add clickable'>"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.add_personal_record")))+"</span>"),r.push("  <div class='confirm float-right'>\n    <strong>"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.saved")))+"</strong>\n  </div>\n</td>\n<td class='editable-column' colspan='"+e(t(2))+"'>\n  <form>"),n=this.personalRecord.getHoursMinutesSeconds(),o="",this.personalRecord.get("activity_id")&&(o="http://www.strava.com/activities/"+this.personalRecord.get("activity_id")),r.push("    <label for='pr_time_min'>"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.time")))+"</label>"),this.personalRecord.get("record_type")>5e3&&r.push("    <input class='short' type='number' name='pr_time_hr' placeholder='"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.hour")))+"' value='"+e(t(n[0]))+"'>"),r.push("    <input class='short' type='number' name='pr_time_min' placeholder='"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.minute")))+"' value='"+e(t(n[1]))+"'>\n    <input class='short' type='number' name='pr_time_sec' placeholder='"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.second")))+"' value='"+e(t(n[2]))+"'>\n    <a class='alt button compact save' href='javascript:;'>"),r.push(this.personalRecord.isNew()?"      "+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.add_pr"))):"      "+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.update_pr")))),r.push("    </a>\n    <a class='cancel'>"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.cancel")))+"</a>\n    <div class='inline-inputs'>\n      <span>\n        <label for='pr_results'>"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.race_results")))+"</label>\n        <input type='text' name='pr_results' placeholder='"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.paste_your_race_result_url_here")))+"' value='"+e(t(this.personalRecord.get("results")))+"'>\n      </span>\n      <span>\n        <label for='pr_activity'>"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.strava_activity")))+"</label>\n        <input type='text' name='pr_activity' placeholder='"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.paste_your_strava_activity_link_here")))+"' value='"+e(t(o))+"'>\n      </span>\n    </div>\n  </form>\n</td>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["personal_records/index"]=function(t){return function(){var t,e,r;return e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<tr>\n  <th>\n    <span class='glossary-link new-version' data-glossary-term='definition-all-time-prs'>"),r.push("      "+e(t(Strava.I18n.Locale.t("templates.personal_records.index.all_time_prs")))),r.push("    </span>\n  </th>\n  <th class='viewing'>"),this.canEdit&&r.push("    <button class='compact' id='add-pr'>"+e(t(Strava.I18n.Locale.t("templates.personal_records.index.add_pr")))+"</button>"),r.push("  </th>"),this.viewerPersonalRecords&&r.push("  <th class='viewer'></th>"),r.push("</tr>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["personal_records/lightbox_content"]=function(t){return function(){var t,e,r;return e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<header>\n  <h3 class='marginless'>"),r.push("    "+e(t(Strava.I18n.Locale.t("templates.personal_records.lightbox_content.all_time")))),r.push("  </h3>\n</header>\n<div class='content'>\n  <table class='dense hoverable marginless'>\n    <thead>\n      <tr>\n        <th>"+e(t(Strava.I18n.Locale.t("templates.personal_records.lightbox_content.race_distance")))+"</th>\n        <th colspan='"+e(t(2))+"'>"+e(t(Strava.I18n.Locale.t("templates.personal_records.lightbox_content.time")))+"</th>\n      </tr>\n    </thead>\n    <tbody></tbody>\n  </table>\n</div>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["personal_records/row"]=function(t){return function(){var t,e,r,o,n;return e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<td>"+e(t(Strava.I18n.Locale.t("templates.personal_records.edit.distances."+this.distance+"m")))+"</td>\n<td class='viewing'>"),this.athletePersonalRecord.get("elapsed_time")?(n=this.athletePersonalRecord.get("results")||this.athletePersonalRecord.get("activity_id"),o=(new Strava.I18n.TimespanFormatter).display(this.athletePersonalRecord.get("elapsed_time")),r.push(n?"  <span class='clickable pr'>"+e(t(o))+"</span>":this.viewerPersonalRecord?"  "+e(t(o)):"  <span class='clickable no-result pr'>"+e(t(o))+"</span>")):r.push("  &mdash;"),r.push("</td>"),this.viewerPersonalRecord&&(r.push("<td class='viewer'>"),this.viewerPersonalRecord.get("elapsed_time")?(n=this.viewerPersonalRecord.get("results")||this.viewerPersonalRecord.get("activity_id"),o=(new Strava.I18n.TimespanFormatter).display(this.viewerPersonalRecord.get("elapsed_time")),r.push(n?"  <span class='clickable pr'>"+e(t(o))+"</span>":"  "+e(t(o)))):r.push("  &mdash;"),r.push("</td>")),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.EditGoalsView=function(e){function r(t){var e,o,n,a;for(r.__super__.constructor.call(this,t),this.athleteId=t.athleteId,this.viewModels=[new Strava.ProgressGoals.EditViewModel(t.weekProgress,this.athleteId,"week"),new Strava.ProgressGoals.EditViewModel(t.yearProgress,this.athleteId,"year")],n=this.viewModels,e=0,o=n.length;o>e;e++)a=n[e],this.initializeGoals(a)}return t(r,e),r.prototype.events={"submit form":"save","click .js-cancel":"cancel","click .toggle-goal":"toggleGoal","click .btn-group button":"changeGoalType"},r.prototype.initializeGoals=function(t){var e,r,o,n,a;for(o=t.sports,e=0,r=o.length;r>e;e++)n=o[e],a=this.$(".media[data-type='"+n+"'][data-period='"+t.period+"'] .toggle-goal"),t.isActive(n)?this.enableGoal(a):this.disableGoal(a),this.setGoalType(t.period,n,t.goalType(n));return this},r.prototype.save=function(t){var e,r;return t.preventDefault(),e=this.$(t.currentTarget).closest(".tab-content").data("sport"),r=this.viewModels.map(function(t){return function(r){var o,n;return n=".media[data-period='"+r.period+"'] input[name='"+e+"-goal']",o=t.$(n).val(),r.saveGoalForSport(e,o)}}(this)),jQuery.when.apply(jQuery,r).done(function(t){return function(){return t.trigger("saveOrCancel",t)}}(this))},r.prototype.cancel=function(){return this.trigger("saveOrCancel",this)},r.prototype.toggleGoal=function(t){var e,r,o;return o=this.$$(t.currentTarget),r=o.closest(".media").data("type"),e=o.closest(".media").data("period"),o.hasClass("active")?(this.disableGoal(o),this.viewModel(e).disable(r)):(this.enableGoal(o),this.viewModel(e).enable(r))},r.prototype.setGoalType=function(t,e,r){var o;return o=this.$(".media[data-type='"+e+"'][data-period='"+t+"'] button[data-type='"+r+"']"),o.closest(".btn-group").find("button").removeClass("active"),o.addClass("active")},r.prototype.changeGoalType=function(t){var e,r,o,n;return e=this.$$(t.target).closest("button"),o=e.closest(".media").data("type"),r=e.closest(".media").data("period"),n=e.data("type"),e.closest(".btn-group").find("button").removeClass("active"),e.addClass("active"),this.viewModel(r).changeType(o,n),!1},r.prototype.enableGoal=function(t){return t.addClass("active"),t.parent(".media").find('input[type="number"], button').prop("disabled",!1),t.parent(".media").find("img").removeClass("disabled"),t.parent(".media").find(".app-icon").addClass("icon-dark")},r.prototype.disableGoal=function(t){return t.removeClass("active"),t.parent(".media").find('input[type="number"], button').prop("disabled",!0),t.parent(".media").find("img").addClass("disabled"),t.parent(".media").find(".app-icon").removeClass("icon-dark")},r.prototype.viewModel=function(t){return _.find(this.viewModels,function(e){return e.period===t})},r}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["progress_goals/edit_view"]=function(t){return function(){var t,e,r,o,n,a,i;for(e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<form>\n  <input class='btn-primary btn-xs float-right topless' type='submit' value='"+e(t(Strava.I18n.Locale.t("templates.progress_goals.edit_view.save")))+"'>\n  <h3>"+e(t(this.title))+"</h3>"),a=this.sports,o=0,n=a.length;n>o;o++)i=a[o],r.push("  <div class='inline-inputs' data-type='"+e(t(i))+"'>\n    <div class='toggle-button'>\n      <div class='btn'></div>\n    </div>\n    <label class='vh' for='"+e(t(i))+"_goal'>"+e(t(Strava.I18n.Locale.t("templates.progress_goals.edit_view."+i+"_goal")))+"</label>\n    <input class='goal-value input-sm short' id='"+i+"_goal' type='number' name='"+e(t(i))+"_goal' min='0' max='"+e(t(this.yearlyGoalCaps[i]))+"' value='"+e(t(this.goals[i].get("amount")))+"'>\n    <div class='btn-group goal-unit'>\n      <button class='btn-sm' data-type='distance'>"),r.push("swim"===i?"        "+e(t((new Strava.I18n.SwimDistanceFormatter).unitShort())):"        "+e(t((new Strava.I18n.DistanceFormatter).unitShort()))),r.push("      </button>\n      <button class='btn-sm' data-type='time'>"+e(t((new Strava.I18n.TimespanFormatter).shortHoursLabel()))+"</button>\n    </div>\n    <div class='"+["app-icon","icon-md","icon","icon-"+e(t(i))+"-v2"].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' title='"+e(t(Strava.I18n.Locale.t("templates.progress_goals.edit_view."+i+"_goal")))+"'></div>\n  </div>");return r.push("</form>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.EditView=function(e){function r(t){var e,o,n,a;for(r.__super__.constructor.call(this,t),this.viewModel=t.viewModel,this.imagePaths={},n=this.viewModel.sports,e=0,o=n.length;o>e;e++)a=n[e],this.imagePaths[a]=t[a+"ImagePath"];this.title=t.title,this.viewModel.on("goalEnabled",function(t){return function(e){return t.focusGoal(e)}}(this))}return t(r,e),r.prototype.template="progress_goals/edit_view",r.prototype.events={"submit form":"saveOrCancel","click .toggle-button":"toggleGoal","click .btn-group button":"changeGoalType"},r.prototype.render=function(){return this.renderTemplate({sports:this.viewModel.sports,goals:this.viewModel.goalsBySport,imagePaths:this.imagePaths,title:this.title,yearlyGoalCaps:{swim:208e4,ride:2e5,run:4e4}}),this.initializeGoals()},r.prototype.saveOrCancel=function(t){var e,r,o,n,a,i;for(t.preventDefault(),n={},a=this.viewModel.sports,r=0,o=a.length;o>r;r++)i=a[r],n[i]=this.$('input[name="'+i+'_goal"]').val();return e=this.viewModel.save(n),e.done(function(t){return function(){return t.trigger("saveOrCancel",t)}}(this))},r.prototype.initializeGoals=function(){var t,e,r,o,n;for(r=this.viewModel.sports,t=0,e=r.length;e>t;t++)o=r[t],n=this.$('.inline-inputs[data-type="'+o+'"] .toggle-button'),this.viewModel.isActive(o)?this.enableGoal(n):this.disableGoal(n),this.setGoalType(o,this.viewModel.goalType(o));return this},r.prototype.focusGoal=function(t){return this.$('input[name="'+t+'_goal"]').focus()},r.prototype.toggleGoal=function(t){var e,r;return r=this.$$(t.target).closest(".toggle-button"),e=r.closest(".inline-inputs").data("type"),r.hasClass("active")?(this.disableGoal(r),this.viewModel.disable(e)):(this.enableGoal(r),this.viewModel.enable(e))},r.prototype.setGoalType=function(t,e){var r;return r=this.$(".inline-inputs[data-type='"+t+"'] button[data-type='"+e+"']"),r.closest(".btn-group").find("button").removeClass("active"),r.addClass("active")},r.prototype.changeGoalType=function(t){var e,r,o;return e=this.$$(t.target).closest("button"),r=e.closest(".inline-inputs").data("type"),o=e.data("type"),e.closest(".btn-group").find("button").removeClass("active"),e.addClass("active"),this.viewModel.changeType(r,o),!1},r.prototype.enableGoal=function(t){return t.addClass("active"),t.parent(".inline-inputs").find('input[type="number"], button').prop("disabled",!1),t.parent(".inline-inputs").find("img").removeClass("disabled"),t.parent(".inline-inputs").find(".app-icon").addClass("icon-dark")},r.prototype.disableGoal=function(t){return t.removeClass("active"),t.parent(".inline-inputs").find('input[type="number"], button').prop("disabled",!0),t.parent(".inline-inputs").find("img").addClass("disabled"),t.parent(".inline-inputs").find(".app-icon").removeClass("icon-dark")},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.ProgressGoal=function(e){function r(t,e){this.athleteId=t,r.__super__.constructor.call(this,e),this.amountWhenDisabled=null}return t(r,e),r.prototype.defaults={period:"week"},r.prototype.urlRoot=function(){return"/athletes/"+this.athleteId+"/goals"},r.prototype.setGoal=function(t,e,r){var o,n;return n=e>0,e="distance"===t?(o="swim"===this.get("activity_type")?new Strava.I18n.SwimDistanceFormatter:new Strava.I18n.GoalDistanceFormatter,(new TwitterCldr.NumberParser).parse(o.format(e))):(new Strava.I18n.TimespanFormatter).hoursMinutesSeconds(e)[0],this.set({type:t,amount:e,period:r,active:n})},r.prototype.updateGoalAmount=function(t){return this.get("active")?this.set("amount",t):void 0},r.prototype.enable=function(){return this.set("active",!0),this.amountWhenDisabled?this.set("amount",this.amountWhenDisabled):void 0},r.prototype.disable=function(){return this.amountWhenDisabled=this.get("amount"),this.set({amount:0,active:!1})},r}(Backbone.Model)}.call(this),function(){Strava.module("Strava.I18n"),Strava.I18n.Locale=function(){function t(){}return t.COUNT_PARAMETER="count",t.DECIMAL_FORMATTER=new TwitterCldr.DecimalFormatter,t.t=function(t,e,r,o){var n,a,i,s,l,c,p,u,h,d;null==e&&(e={}),null==r&&(r=Strava.I18n.Locales.DICTIONARY),null==o&&(o=Strava.I18n.Locales.PLURALIZATION),d=r,l=t.split("."),Strava.I18n.Locale.COUNT_PARAMETER in e&&(h=o(e[Strava.I18n.Locale.COUNT_PARAMETER]));for(a=0,c=l.length;c>a;a++)if(s=l[a],d=d[s],null==d)return t;if(null!=h){for(n=!1,i=0,p=h.length;p>i;i++)if(u=h[i],null!=d[u]){d=d[u],n=!0;break}if(!n)return t}return this.resolve(d,e)},t.resolve=function(t,e){return t.replace(/%%|%{(\w+)}/g,function(t,r){if("%%"===t)return"%";if(r in e)return r===Strava.I18n.Locale.COUNT_PARAMETER?Strava.I18n.Locale.DECIMAL_FORMATTER.format(e[r]):e[r];throw new Error("param "+r+" not provided")})},t.measurementPreference=function(){return window._measurement_preference},t.unitSystem=function(){return"feet"===this.measurementPreference()?"imperial":"metric"},t}()}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.I18n"),Strava.I18n.GoalDistanceFormatter=function(e){function r(t){null==t&&(t=Strava.I18n.Locale.unitSystem()),r.__super__.constructor.call(this,t,"distance",0)}return t(r,e),r.prototype.convert=function(t){var e;return e="metric"===this.unitSystem?1e3:1609.344,t/e},r}(Strava.I18n.UnitSystemFormatter)}.call(this),function(){Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.EditViewModel=function(){function t(t,e,r){var o,n,a,i;for(this.period=r,this.sports=t.pluck("sport"),this.goalsBySport={},a=this.sports,o=0,n=a.length;n>o;o++)i=a[o],this.goalsBySport[i]=new Strava.ProgressGoals.ProgressGoal(e,{active:!1,activity_type:i,type:"distance",amount:0});t.each(function(t){return function(e){return i=e.get("sport"),t.goalsBySport[i].setGoal(e.dimension(),e.goalAmount(),e.period())}}(this))}return Strava.includeModule(t,Backbone.Events),t.prototype.isActive=function(t){return this.goalsBySport[t].get("active")},t.prototype.goalType=function(t){return this.goalsBySport[t].get("type")},t.prototype.disable=function(t){return this.goalsBySport[t].disable()},t.prototype.enable=function(t){return this.goalsBySport[t].enable(),this.trigger("goalEnabled",t)},t.prototype.changeType=function(t,e){return this.goalsBySport[t].set("type",e)},t.prototype.saveGoalForSport=function(t,e){return this.goalsBySport[t].updateGoalAmount(e),this.goalsBySport[t].save()
},t.prototype.save=function(t){var e,r,o,n;e=new jQuery.Deferred;for(o in t)r=t[o],this.goalsBySport[o].updateGoalAmount(r);return n=this.sports.map(function(t){return function(e){return t.goalsBySport[e].save()}}(this)),jQuery.when.apply(jQuery,n).done(function(){return e.resolve()}),e},t}()}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.GoalPageView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.events={"click .edit-goals-btn":"edit","click ul.tabs > li":"onSwitchTabClick"},r.prototype.initialize=function(t){var e;return this.PROGRESS_GOALS_KEY="strava.progressGoals",this.options=t,this.athleteId=t.athleteId,this.weeklyGoalPageView=t.weeklyGoalPageView,this.yearlyGoalPageView=t.yearlyGoalPageView,this.editGoalsView=new Strava.ProgressGoals.EditGoalsView({el:this.el,athleteId:t.athleteId,weekProgress:t.weekProgress,yearProgress:t.yearProgress}),this.containingPage=t.containingPage,this.editGoalsView.on("saveOrCancel",this.refreshModule,this),this.resizeHandler(),Modernizr.localstorage&&(e=JSON.parse(localStorage.getItem(this.PROGRESS_GOALS_KEY)))?this.switchTab(e.selectedTabName):void 0},r.prototype.render=function(){return this.weeklyGoalPageView.renderCharts(!0),this.yearlyGoalPageView.renderCharts()},r.prototype.edit=function(t){var e;return e=this.$(t.currentTarget).closest(".tab-content"),e.find(".js-view").hide(),e.find(".js-edit").show()},r.prototype.refreshModule=function(){return jQuery.ajax("/athletes/"+this.athleteId+"/goals/goals_sidebar",{data:{containing_page:this.containingPage},type:"GET",contentType:"application/html",dataType:"html",success:function(t){return function(e){return t.$el.replaceWith(e)}}(this)})},r.prototype.resizeHandler=function(){var t;return currentAthlete.get("logged_in")?(t=null,jQuery(window).on("resize",function(e){return function(){return t?void 0:t=setTimeout(function(){return t=null,e.refreshModule()},300)}}(this))):void 0},r.prototype.onSwitchTabClick=function(t){var e,r;return t.preventDefault(),e=this.$(t.currentTarget),r=e.attr("aria-controls"),this.switchTab(r)},r.prototype.switchTab=function(t){var e;return e=this.$(".tab-contents #"+t),0!==e.length?(Modernizr.localstorage&&localStorage.setItem(this.PROGRESS_GOALS_KEY,JSON.stringify({selectedTabName:t})),this.$("li").attr("aria-selected","false"),this.$("#"+t+"-tab").attr("aria-selected","true"),this.$(".tab-content").attr("aria-hidden","true"),e.attr("aria-hidden","false"),"dashboard"===this.containingPage?"relative-effort-goals"===t?jQuery("#js-dashboard-athlete-goals").find(".card-footer").hide():jQuery("#js-dashboard-athlete-goals").find(".card-footer").show():void 0):void 0},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.WeekActivityView=function(e){function r(t){r.__super__.constructor.call(this,t),this.canvasHeight=t.canvasDimensions.height,this.canvasWidth=t.canvasDimensions.width,this.chartWidthPercentage=t.chartWidthPercentage,this.volumeData=this.model.volumeForChart(),this.currentDayOfWeek=(new Date).getDay(),0===this.currentDayOfWeek&&(this.currentDayOfWeek=7),this.setupChart()}return t(r,e),r.prototype.WEEKDAY_NAMES=TwitterCldr.Calendar.weekdays({format:"stand-alone",names_form:"narrow"}),r.prototype.WEEKDAY_KEYS={0:"mon",1:"tue",2:"wed",3:"thu",4:"fri",5:"sat",6:"sun"},r.prototype.render=function(){var t,e;return t=d3.select(this.el).selectAll(".volume-bar-container").data(this.volumeData).enter().append("g").attr("transform",function(t){return function(e,r){return"translate("+t.xScale(r+1)+",0)"}}(this)).attr("class","volume-bar-container"),t.append("rect").attr("class",function(t){return function(e,r){return"volume-bar "+t.dayOfWeekClass(r)}}(this)).classed("highlighted",function(t){return function(e,r){return r===t.currentDayOfWeek-1}}(this)).classed("past",function(t){return function(e,r){return r<t.currentDayOfWeek-1}}(this)).classed("future",function(t){return function(e,r){return r>t.currentDayOfWeek-1}}(this)).attr("y",function(t){return function(e){return Math.min(t.chartHeight-2,t.yScale(e))}}(this)).attr("height",function(t){return function(e){return Math.max(2,t.chartHeight-t.yScale(e))}}(this)).attr("width",this.xScale.rangeBand()-6),e=d3.select(this.el).selectAll(".day-label-container").data(this.volumeData).enter().append("g").attr("transform",function(t){return function(e,r){return"translate("+t.xScale(r+1)+","+(t.chartHeight+15)+")"}}(this)).attr("class","day-label-container").append("text").attr("class",function(t){return function(e,r){return"day-label "+t.dayOfWeekClass(r)}}(this)).attr("x",0).attr("y",0).text(function(t){return function(e,r){return t.WEEKDAY_NAMES[t.WEEKDAY_KEYS[r]]}}(this))},r.prototype.setupChart=function(){return this.chartMargins={top:5,left:5,bottom:15,right:5},this.chartWidth=this.chartWidthPercentage*(this.canvasWidth-(this.chartMargins.left+this.chartMargins.right)),this.chartHeight=this.canvasHeight-(this.chartMargins.top+this.chartMargins.bottom),this.xScale=d3.scale.ordinal().domain(d3.range(1,8)).rangeBands([0,this.chartWidth]),this.yScale=d3.scale.linear().domain([0,d3.max(this.volumeData)]).range([this.chartHeight,0])},r.prototype.dayOfWeekClass=function(t){return t===this.currentDayOfWeek-1?"highlighted":t<this.currentDayOfWeek-1?"past":"future"},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.WeekProgressEntry=function(e){function r(t){t.id=t.id+"-"+t.sport,r.__super__.constructor.call(this,t)}return t(r,e),r.prototype.enhancedAttributes=function(){return this.set("has_goal",this.hasGoal()),this.set("goal_dimension",this.goalDimension()),this.set("actual_dimension",this.actualDimension()),this.set("second_dimension",this.secondDimension()),this.set("third_dimension",this.thirdDimension()),this.set("second_third_dimensions_visibility",this.secondThirdDimensionsVisibility()),this.set("no_goal_copy",this.noGoalCopy()),this},r.prototype.volumeForChart=function(){var t;return t=this.hasGoal()&&"TimeGoal"===this.goalType()?"moving_time":"distance",_.map(this.get("by_day_of_week"),function(e){return _.reduce(_.pluck(e.activities,t),function(t,e){return t+e},0)})},r.prototype.percentageOfGoal=function(){return this.hasGoal()&&this.goalValue()>0?Math.min(this.goalProgress()/this.goalValue(),1):0},r.prototype.goalProgress=function(){return this.hasGoal()?"TimeGoal"===this.goalType()?this.totalMovingTime():this.totalDistance():0},r.prototype.goalAmount=function(){return this.hasGoal()?this.goalValue():0},r.prototype.dimension=function(){var t;return this.hasGoal()?(t=this.goalType(),"TimeGoal"===t?"time":"distance"):"distance"},r.prototype.period=function(){return"week"},r.prototype.noGoalCopy=function(){return Strava.I18n.Locale.t("strava.progress_goals.week_progress_entry.set_goal")},r.prototype.hasGoal=function(){return"time_goal"===this.singleSportDisplayType()||"distance_goal"===this.singleSportDisplayType()},r.prototype.goalDimension=function(){var t;return"time_goal"===this.singleSportDisplayType()?(new Strava.I18n.TimespanFormatter).abbreviatedHours(this.goalValue(),!1):"distance_goal"===this.singleSportDisplayType()?(t="swim"===this.sport()?new Strava.I18n.SwimDistanceFormatter:new Strava.I18n.GoalDistanceFormatter,t.formatShort(this.goalValue())):void 0},r.prototype.actualDimension=function(){return"time_goal"===this.singleSportDisplayType()?(new Strava.I18n.TimespanFormatter).abbreviated(this.totalMovingTime(),!1):"distance_goal"===this.singleSportDisplayType()?(new Strava.I18n.DistanceFormatter).format(this.totalDistance(),1,!1):"distance_no_goal"===this.singleSportDisplayType()?(new Strava.I18n.DistanceFormatter).formatShort(this.totalDistance(),1,!1):void 0},r.prototype.secondDimension=function(){return"time_goal"===this.singleSportDisplayType()?(new Strava.I18n.DistanceFormatter).formatShort(this.totalDistance(),1,!1):"distance_goal"===this.singleSportDisplayType()||"distance_no_goal"===this.singleSportDisplayType()?(new Strava.I18n.TimespanFormatter).abbreviated(this.totalMovingTime(),!1):void 0},r.prototype.thirdDimension=function(){return(new Strava.I18n.ElevationFormatter).formatShort(this.totalElevGain())},r.prototype.secondThirdDimensionsVisibility=function(){return this.totalDistance()>0?"":"no-activity"},r.prototype.goalType=function(){return this.goalObj().type},r.prototype.goalValue=function(){return this.goalObj().goal},r.prototype.goalObj=function(){return this.get("goals_by_sport")[this.sport()]},r.prototype.totalDistance=function(){return this.totalsForSport().distance},r.prototype.totalMovingTime=function(){return this.totalsForSport().moving_time},r.prototype.totalElevGain=function(){return this.totalsForSport().elev_gain},r.prototype.singleSportDisplayType=function(){var t;return t=this.get("display_type"),"multisport_goal"!==t?t:this.goalObj()&&this.goalValue()>0?"TimeGoal"===this.goalType()?"time_goal":"DistanceGoal"===this.goalType()?"distance_goal":void 0:"distance_no_goal"},r.prototype.totalsForSport=function(){return this.get("totals_by_sport")[this.sport()]},r.prototype.sport=function(){return this.get("sport")},r}(Backbone.Model)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.WeekProgress=function(e){function r(t,e){this.athleteId=t,r.__super__.constructor.call(this,e)}return t(r,e),r.prototype.model=Strava.ProgressGoals.WeekProgressEntry,r.prototype.visibleSports=function(){return this.filter(function(t,e){return 0===e||t.hasGoal()})},r.prototype.url=function(){return"/athletes/"+this.athleteId+"/goals/current_week"},r}(Backbone.Collection)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.WeekProgressUpsellEntry=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.volumeForChart=function(){return this.get("volume_by_day")},r.prototype.percentageOfGoal=function(){return this.get("percentage_of_goal")},r}(Backbone.Model)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.WeekProgressView=function(e){function r(t){r.__super__.constructor.call(this,t),this.canvasHeight=t.canvasDimensions.height,this.canvasWidth=t.canvasDimensions.width,this.imagePath=t.imagePath,this.percentageOfGoal=this.model.percentageOfGoal(),this.setupChart()}var o,n,a,i,s;return t(r,e),n=30,a=32,s=28,i=28,o=1e3,r.prototype.render=function(){var t,e,r,l,c,p,u;return u=2*Math.PI,t=d3.svg.arc().innerRadius(n).outerRadius(a).startAngle(0),p=d3.select(this.el).append("g").attr("transform","translate("+this.chartWidth/2+","+this.chartHeight/2+")").attr("class","progress-container"),1===this.percentageOfGoal&&p.append("circle").attr("r",a).attr("class","goal-complete"),r=p.append("path").datum({endAngle:u}).attr("class","bg-circle").attr("d",t),l="0.20",this.percentageOfGoal>0&&(l="0.60"),p.append("image").attr("transform","translate(-14, -14)").attr("class","sport-type").attr("xlink:href",this.imagePath).attr("width",s).attr("height",i).attr("opacity",l),this.percentageOfGoal>0?(c=p.append("path").datum({endAngle:0}).attr("d",t).attr("class","progress-bar"),e=function(e,r){return e.attrTween("d",function(e){var o;return o=d3.interpolate(e.endAngle,r),function(r){return e.endAngle=o(r),t(e)}})},c.transition().duration(o).call(e,this.percentageOfGoal*u)):void 0},r.prototype.setupChart=function(){return this.chartMargins={top:5,left:5,bottom:5,right:5},this.chartWidth=.5*(this.canvasWidth-(this.chartMargins.left+this.chartMargins.right)),this.chartHeight=this.canvasHeight-(this.chartMargins.top+this.chartMargins.bottom)},r}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["progress_goals/stats_view"]=function(t){return function(){var t,e,r;return e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<span class='actual'>"+t(this.stats.actual_dimension)+"</span>"),this.stats.has_goal&&r.push(""+t("/ "+this.stats.goal_dimension)),r.push(this.stats.has_goal?"<ul class='"+["inline-stats",""+e(t(this.stats.second_third_dimensions_visibility))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <li>"+t(this.stats.second_dimension)+"</li>\n  <li>"+t(this.stats.third_dimension)+"</li>\n</ul>":"<div class='upsell-sm'>\n  <div class='bw sm strava-echelon'></div>\n  <span class='clickable minimal'>"+e(t(this.stats.no_goal_copy))+"</span>\n</div>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.WeekStatsView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.template="progress_goals/stats_view",r.prototype.render=function(){return this.renderTemplate({stats:this.model.enhancedAttributes().toJSON()})},r}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["progress_goals/week_view"]=function(t){return function(){var t,e,r;return e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<div class='primary-stats'></div>\n<svg width='"+e(t(190))+"' height='"+e(t(68))+"'>\n  <g class='activity-chart' transform='translate(5, 5)'></g>\n  <g class='progress-chart' transform='translate(110, 7)'></g>\n</svg>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.WeekUpsellView=function(e){function r(t){t.el=this.$$(t.elSelector),r.__super__.constructor.call(this,t),this.activityChartClass=t.activityChartClass,this.progressChartClass=t.progressChartClass,this.chartWidthPercentage=t.chartWidthPercentage,this.rideImagePath=t.rideImagePath,this.runImagePath=t.runImagePath,this.model=new Strava.ProgressGoals.WeekProgressUpsellEntry(t.modelAttributes)}return t(r,e),r.prototype.template="progress_goals/week_view",r.prototype.renderCharts=function(){var t,e;return t=this.$("svg"),e={width:t.attr("width"),height:t.attr("height")},new Strava.ProgressGoals.WeekActivityView({model:this.model,el:this.$("."+this.activityChartClass),canvasDimensions:e,chartWidthPercentage:this.chartWidthPercentage}).render(),new Strava.ProgressGoals.WeekProgressView({model:this.model,el:this.$("."+this.progressChartClass),imagePath:this.imagePath(),canvasDimensions:e}).render()},r.prototype.imagePath=function(){var t;return t="",t="ride"===this.model.get("sport")?this.rideImagePath:"run"===this.model.get("sport")?this.runImagePath:this.swimImagePath},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.WeekView=function(e){function r(t){r.__super__.constructor.call(this,t),this.activityChartClass=t.activityChartClass,this.progressChartClass=t.progressChartClass,this.chartWidthPercentage=t.chartWidthPercentage,this.rideImagePath=t.rideImagePath,this.runImagePath=t.runImagePath,this.swimImagePath=t.swimImagePath}return t(r,e),r.prototype.template="progress_goals/week_view",r.prototype.render=function(){return this.renderTemplate({}),this.$el.addClass("row").addClass("week"),this.renderStats(),this.renderCharts(),this},r.prototype.renderStats=function(){return new Strava.ProgressGoals.WeekStatsView({model:this.model,el:this.$(".primary-stats")}).render()},r.prototype.renderCharts=function(){var t,e;return t=this.$("svg"),e={width:t.attr("width"),height:t.attr("height")},new Strava.ProgressGoals.WeekActivityView({model:this.model,el:this.$("."+this.activityChartClass),canvasDimensions:e,chartWidthPercentage:this.chartWidthPercentage}).render(),new Strava.ProgressGoals.WeekProgressView({model:this.model,el:this.$("."+this.progressChartClass),imagePath:this.imagePath(),canvasDimensions:e}).render()},r.prototype.imagePath=function(){var t;return t="",t="ride"===this.model.get("sport")?this.rideImagePath:"run"===this.model.get("sport")?this.runImagePath:this.swimImagePath},r}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["performance_goals/tooltip"]=function(t){return function(){var t,e,r;return e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<div id='js-snw-performance-goals-upsell'>\n  <a class='dismiss' href='javascript:;'>"),r.push("    "+e(t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.dismiss")))),r.push("  </a>\n  <h4 class='h5 title'>\n    <div class='badge premium sm'></div>"),r.push("    "+e(t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.goals")))),r.push("  </h4>\n  <div class='content'>"),r.push("    "+t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.upsell_v3_html"))),r.push("  </div>\n  <div class='arrow bottom'></div>\n</div>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Ui"),Strava.Ui.TooltipView=function(e){function r(t){r.__super__.constructor.call(this),JST[t]?this.template=t:this.createTemplate(t)}return t(r,e),r.prototype.tagName="div",r.prototype.className="super-tooltip",r.prototype.attributes={style:"display: none"},r.prototype.events={"click .dismiss":"dismissTooltip"},r.prototype.render=function(t,e){return this.renderTemplate({data:this.prepareData(t)}),this.delegateEvents(),this.show(e),this},r.prototype.prepareData=function(t){return t},r.prototype.show=function(t){var e,r,o,n,a,i;return this.$$(".super-tooltip").remove(),this.$$("body").append(this.el),r=this.$$(t),i=r.offset(),e=this.$("div.arrow"),n=e.hasClass("top")?i.top+r.outerHeight()+10:i.top-(this.$el.height()+15),a=!1,0>n?(n=0,a=!0):n+this.$el.outerHeight()>this.$$(window).height()+window.pageYOffset&&(n=this.$$(window).height()+window.pageYOffset-this.$el.outerHeight(),a=!0),o=i.left-this.$el.width()/2+r.outerWidth()/2,0>o?(o=0,a=!0):o+this.$el.outerWidth()>this.$$(window).width()+window.pageXOffset&&(o=this.$$(window).width()+window.pageXOffset-this.$el.outerWidth(),a=!0),a&&e.hide(),this.$el.css({left:o,top:n}),this.$el.fadeIn("fast")},r.prototype.dismissTooltip=function(){return this.$el.remove(),!1},r.createInstance=function(t,e){return null==this.instance&&(this.instance=new e(t),this.instance.$document().click(function(t){return function(e){return t.instance.$el.is(":visible")&&!jQuery(e.target).parents(".super-tooltip").length?t.instance.dismissTooltip():void 0}}(this))),this.instance},r.show=function(t,e){return this.instance.render(t,e)},r}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["ui/premium_tooltip"]=function(t){return function(){var t,e,r;return e=window.HAML.escape,t=window.HAML.cleanValue,r=[],r.push("<button class='btn btn-unstyled btn-xs dismiss' title='"+e(t(Strava.I18n.Locale.t("templates.ui.premium_tooltip.dismiss")))+"'>\n  <div class='app-icon icon-close icon-dark icon-xs'></div>\n</button>\n<div class='centered text-center tooltip-block'>\n  <div class='app-icon icon-badge-premium icon-sm mb-xs'></div>\n  <p>"+e(t(Strava.I18n.Locale.t("templates.ui.premium_tooltip.copy_v2")))+"</p>\n  <a class='btn btn-primary btn-sm button' id='js-snw-segment-set-goal-upsell-cta' href='"+e(t(this.data.url))+"'>"),r.push("    "+e(t(Strava.I18n.Locale.t("templates.ui.premium_tooltip.join_summit")))),r.push("  </a>\n</div>\n<div class='bottom tooltip-arrow'></div>"),r.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.WeeklyGoalPageView=function(e){function r(t){t.el=this.$$(t.elSelector),r.__super__.constructor.call(this,t),this.activityChartClass=t.activityChartClass,this.progressChartClass=t.progressChartClass,this.rideImagePath=t.rideImagePath,this.runImagePath=t.runImagePath,this.swimImagePath=t.swimImagePath,this.chartWidthPercentage=t.chartWidthPercentage}return t(r,e),r.prototype.renderCharts=function(t){var e;return null==t&&(t=!1),e=t?this.collection:this.collection.visibleSports(),e.forEach(function(t){return function(e){return new Strava.ProgressGoals.WeekView({el:t.$("#"+e.get("sport")),model:e,activityChartClass:t.activityChartClass,progressChartClass:t.progressChartClass,chartWidthPercentage:t.chartWidthPercentage,rideImagePath:t.rideImagePath,runImagePath:t.runImagePath,swimImagePath:t.swimImagePath}).renderCharts()}}(this))},r}(Backbone.View)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.YearlyGoal=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.dimension=function(){return"TimeGoal"===this.get("goal_type")?"time":"distance"},r.prototype.period=function(){return"year"},r.prototype.goalAmount=function(){return this.get("goal_amount")},r}(Backbone.Model)}.call(this),function(){Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.YearlyGoalChart=function(){function t(t,e,r,o){this.selector=t,this.dataContext=e,null==r&&(r=!0),null==o&&(o=null),this.showGoalLabel=r,this.width=o}var e,r,o,n,a,i;return e=1e3,r={height:34,width:186,padding:{top:14,bottom:0,left:20,right:10}},o={height:50,padding:{top:14,bottom:0,left:20,right:0}},n={height:15,width:186},a={top:r.height+5,left:r.padding.left},i={top:o.height+5,left:o.padding.left},t.prototype.render=function(){return d3.select(this.selector).empty(),this.createComponents()},t.prototype.createComponents=function(){return this.svg=d3.select(this.selector).append("svg").attr("width",this.dims().width).attr("height",this.dims().height).attr("class","progress-bar-svg-container"),this.mainGroup=this.svg.append("g").attr("transform","translate(0, "+this.dims().padding.top+")"),this.createScales(),this.dataContext.showTooltip()&&this.createTooltip(),this.createProgressBar(),this.showGoalLabel?this.createLabel():void 0},t.prototype.createScales=function(){return this.xScale=d3.scale.linear().domain(this.dataContext.progressExtent()).range([0,this.progressBarDims().width]).clamp(!0)},t.prototype.createTooltip=function(){var t;return t=jQuery(this.selector).parent(),this.tooltip=new Strava.ProgressGoals.YearlyGoalTooltip(t,this.dataContext.tooltipLabel(),this.tooltipDims())},t.prototype.createProgressBar=function(){var t,r,o,n,a;return n=this.xScale(this.dataContext.projectedProgress()),a=this.progressBarDims().height,this.mainGroup.append("rect").attr("height",this.progressBarDims().height).attr("width",this.progressBarDims().width).attr("class","progress-bar-container").on("mouseover",function(t){return function(){return t.showTooltip(n)}}(this)).on("mouseout",function(t){return function(){return t.hideTooltip()}}(this)),this.dataContext.showProgress()&&(t=this.mainGroup.append("rect").attr("height",this.progressBarDims().height).attr("width",0).attr("class","progress-bar-fill").on("mouseover",function(t){return function(){return t.showTooltip(n)}}(this)).on("mouseout",function(t){return function(){return t.hideTooltip()}}(this)),t.transition().duration(e).attr("width",this.xScale(this.dataContext.progress()))),this.mainGroup.append("line").attr("x1",this.xScale(this.dataContext.projectedProgress())).attr("x2",this.xScale(this.dataContext.projectedProgress())).attr("y1",0).attr("y2",this.progressBarDims().height+5).attr("class","progress-marker"),this.width?(o=this.dataContext.percentYearComplete()<.5?-10:10,r=this.dataContext.percentYearComplete()<.5?"start":"end",this.svg.append("text").attr("text-anchor",r).attr("x",this.xScale(this.dataContext.projectedProgress())+o).attr("y",this.progressBarDims().height+32).attr("class","today-label").text(this.dataContext.todayLabel())):this.mainGroup.append("polygon").attr("points",n+", "+a+" "+(n+3)+", "+(a+5)+" "+(n-3)+", "+(a+5))},t.prototype.createLabel=function(){return this.svg.append("text").attr("text-anchor","end").attr("x",this.progressBarDims().width).attr("y",10).attr("class",this.dataContext.goalTextClasses()).text(this.dataContext.goalLabel())},t.prototype.showTooltip=function(t){return this.tooltip?this.tooltip.show(t):void 0},t.prototype.hideTooltip=function(){return this.tooltip?this.tooltip.hide():void 0},t.prototype.dims=function(){return this.width?{height:o.height,width:this.width,padding:o.padding}:r},t.prototype.progressBarDims=function(){return this.width?{height:10,width:this.width}:n},t.prototype.tooltipDims=function(){return this.width?i:a},t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.YearlyGoalDataContext=function(){function e(e,r){this.sportData=e,this.athletePremium=r,this.goalTextClasses=t(this.goalTextClasses,this),this.tooltipLabel=t(this.tooltipLabel,this)}return e.prototype.showProgress=function(){return this.athletePremium},e.prototype.sport=function(){return this.sportData.get("sport")},e.prototype.goalLabel=function(){return this.sportData.get("goal_label")},e.prototype.todayLabel=function(){return this.sportData.get("today_label")},e.prototype.progressExtent=function(){return[0,_.max([this.sportData.get("progress_extent"),1])]},e.prototype.progress=function(){return this.sportData.get("progress")},e.prototype.projectedProgress=function(){return this.progressExtent()[1]*this.sportData.get("percent_year_complete")},e.prototype.percentYearComplete=function(){return this.sportData.get("percent_year_complete")},e.prototype.showTooltip=function(){return this.sportData.get("show_tooltip")},e.prototype.tooltipLabel=function(){return this.sportData.get("tooltip_label")},e.prototype.goalTextClasses=function(){return this.sportData.get("goal_met")?"goal-label goal-completed-label":"goal-label"},e}()}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.YearlyGoalPageView=function(e){function r(t){t.el=this.$$(t.elSelector),r.__super__.constructor.call(this,t),this.rideImagePath=t.rideImagePath,this.runImagePath=t.runImagePath,this.swimImagePath=t.swimImagePath,this.charts=this.collection.map(function(){return function(e){var r,o;return r=t.elSelector+" #"+e.get("sport").toLowerCase()+"-yearly-progress-container .chart-container",o=new Strava.ProgressGoals.YearlyGoalDataContext(e,t.athletePremium),new Strava.ProgressGoals.YearlyGoalChart(r,o,!1,t.width)}}(this))}return t(r,e),r.prototype.renderCharts=function(){return this.charts.forEach(function(){return function(t){return t.render()}}(this))},r}(Backbone.View)}.call(this),function(){Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.YearlyGoalTooltip=function(){function t(t,e,r){this.container=t,this.offsets=r,this.$tooltip=jQuery("<div></div>").html(e).attr("class","yearly-goal-tooltip"),this.container.append(this.$tooltip)}return t.prototype.show=function(t){var e;return e=this.container.width()-this.container.find(".chart-container svg").width(),this.$tooltip.css("top",this.offsets.top+"px"),this.$tooltip.css("left",e+this.offsets.left+t-this.$tooltip.outerWidth()/2+"px"),this.$tooltip.addClass("yearly-goal-tooltip-visible")},t.prototype.hide=function(){return this.$tooltip.removeClass("yearly-goal-tooltip-visible")},t}()}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.ProgressGoals"),Strava.ProgressGoals.YearlyGoals=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.model=Strava.ProgressGoals.YearlyGoal,r}(Backbone.Collection)}.call(this),function(){Strava.module("Strava.Util"),Strava.Util.ClioAdapter=function(){function t(t){this.clioClient=t,this.loggingEnabled=!1}return t.prototype.trackClick=function(t,e,r){var o,n,a;return this.log("%ctrackClick %O",arguments,"color: blue; font-size: large;"),n="kudos"===e?Strava.Analytics.Models.ClientEvent.newKudo(t):"comment"===e?Strava.Analytics.Models.ClientEvent.newComment(t):(a=Strava.Analytics.Models.ClientEvent.TargetType,o=function(){switch(e){case"self":return a.SELF;case"link":return a.LINK;case"photo":return a.PHOTO;case"avatar":return a.OWNER_AVATAR;case"name":return a.OWNER_NAME;case"map":return a.MAP;case"comment_list":return a.COMMENT_LIST;case"share":return a.SHARE;case"join":return a.JOIN;case"perk":return a.PREMIUM_PERK;case"partner_link":return a.PARTNER_LINK;case"partner_tag":return a.PARTNER_TAG;case"partner_tag_expanded":return a.PARTNER_TAG_EXPANDED;default:return a.SELF}}(),Strava.Analytics.Models.ClientEvent.newClick(t).setTargetType(o)),r&&n.setTargetUrl(r),this.track(n)},t.prototype.trackScreenExit=function(t){return this.log("%ctrackScreenExit %O",arguments,"color: red; font-size: large;"),this.track(Strava.Analytics.Models.ClientEvent.newScreenExit(t))},t.prototype.trackScreenEnter=function(t){return this.log("%ctrackScreenEnter %O",arguments,"color: green; font-size: large;"),this.track(Strava.Analytics.Models.ClientEvent.newScreenEnter(t))},t.prototype.log=function(t,e,r){return this.loggingEnabled?console.log(t,r,e):void 0},t.prototype.track=function(t){return t.setClientUrl(window.location.href),this.clioClient.track(t)},t}()}.call(this),function(){Strava.module("Strava.Tracking"),Strava.Tracking.ImpressionTrackerSet=function(){function t(){this.trackers={}}return t.prototype.addTracker=function(t,e){return this.trackers[t]?void 0:this.trackers[t]={tracker:t,ga:e}},t.prototype.pageEnter=function(){var t,e,r,o;r=this.trackers,o=[];for(e in r)t=r[e],o.push(t.tracker.pageEnter());return o},t.prototype.pageExit=function(){var t,e,r,o;r=this.trackers,o=[];for(e in r)t=r[e],o.push(t.tracker.pageExit());return o},t.prototype.hide=function(){var t,e,r,o;r=this.trackers,o=[];for(e in r)t=r[e],o.push(t.tracker.hide());return o},t.prototype.show=function(){var t,e,r,o;r=this.trackers,o=[];for(e in r)t=r[e],o.push(t.tracker.show());return o},t.prototype.count=function(){return Object.keys(this.trackers).length},t.prototype.reset=function(){var t,e,r;r=this.trackers;for(e in r)t=r[e],t.tracker.pageExit(),t.ga.remove();return this.trackers={}},t}()}.call(this),function(){Strava.module("Strava.Util"),Strava.Util.Autotrack=function(){function t(){this.impressionTrackerSet=new Strava.Tracking.ImpressionTrackerSet,this.pageVisibilityTracker=null
}var e,r;return e=1440,t.prototype.setPageVisibilityTracker=function(t){return this.pageVisibilityTracker=t,this.pageVisibilityTracker.on("pageEnter",function(t){return function(){return t.impressionTrackerSet.pageEnter()}}(this)),this.pageVisibilityTracker.on("pageExit",function(t){return function(){return t.impressionTrackerSet.pageExit()}}(this))},t.prototype.addImpressionTracker=function(t,e){return this.impressionTrackerSet.addTracker(t,e)},t.prototype.setClioTracker=function(t){return this.clioTracker=t},t.prototype.getClioTracker=function(){return this.clioTracker},t.prototype.handleUnload=function(){return this.impressionTrackerSet.pageExit()},t.prototype.handleImpressionReset=function(){return this.impressionTrackerSet.reset()},t.prototype.handleImpressionHide=function(){return this.impressionTrackerSet.hide()},t.prototype.handleImpressionShow=function(){return this.impressionTrackerSet.show()},t.prototype.handleImpressionAppend=function(t){return Strava.Feed.ImpressionTracker.configure(t,this.clioTracker)},r=null,t.getInstance=function(){return r||(r=new this),r},t.configureImpressionTracker=function(t){var e;return e=this.createPlugin("ImpressionTracker",t,{attributePrefix:"str-",elements:t.entities()}),this.getInstance().addImpressionTracker(t,e)},t.configurePageVisibilityTracker=function(t){return this.createPlugin("PageVisibilityTracker",t,{changeTemplate:function(t,e){return e},sessionTimeout:e}),this.getInstance().setPageVisibilityTracker(t)},t.configureEventTracker=function(t){return this.createPlugin("EventTracker",t,{attributePrefix:"str-"})},t.createPlugin=function(t,e,r){return"undefined"!=typeof gaplugins&&null!==gaplugins?new gaplugins[t](e,r):(console.log("gaplugins not found"),null)},t.configurePage=function(t,e,r){var o,n;return o={remote_logger:{request_headers:{"X-CSRF-Token":t}}},n=this.getInstance(),Strava.Analytics.initialize(e,o).then(function(t){var e;return e=new Strava.Util.ClioAdapter(t),n.setClioTracker(e),r(e,n)})},t.configureMore=function(t){var e;return e=this.getInstance(),t(e.getClioTracker())},t}()}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.EventTracker=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.initialize=function(t,e){return this.clioClient=e.clioClient},r.prototype.send=function(t,e){return"anchor_container"===e.type?this.handleAnchorContainer(t,e):this.clioClient.trackClick(e.trackableId,e.type,e.targetUrl)},r.prototype.handleAnchorContainer=function(t,e){var r;if("A"===e.targetTagName)return r=e.click_type?e.click_type:"link",this.clioClient.trackClick(e.trackableId,r,e.targetUrl)},r.configure=function(t){var e;return e=new this({},{clioClient:t}),Strava.Util.Autotrack.configureEventTracker(e)},r}(Backbone.Model)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.PageVisibilityTracker=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.send=function(t,e){if("event"===t){if("visible"===e.eventLabel)return this.trigger("pageEnter");if("hidden"===e.eventLabel)return this.trigger("pageExit")}},r.configure=function(){var t;return t=new this,Strava.Util.Autotrack.configurePageVisibilityTracker(t)},r}(Backbone.Model)}.call(this),function(){var t=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.ImpressionTracker=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}var o;return t(r,e),r.prototype.initialize=function(t,e){return this.clioClient=e.clioClient,this.entityStates={},this.id=o()},r.prototype.toString=function(){return"<ImpressionTracker"+this.id+">"},r.prototype.entities=function(){var t,e,r,o,n,a;for(a=this.get("impressionThreshold"),o=this.get("entityIds"),n=[],e=0,r=o.length;r>e;e++)t=o[e],n.push({trackFirstImpressionOnly:!1,threshold:a,id:t});return n},r.prototype.send=function(t,e){var r;return r=e.eventVisible,r?(this.entityStates[e.trackableId]="enter",this.clioClient.trackScreenEnter(e.trackableId)):(this.entityStates[e.trackableId]="exit",this.clioClient.trackScreenExit(e.trackableId))},r.prototype.pageEnter=function(){var t,e,r,o;t=this.entityStates,e=[];for(o in t)r=t[o],"enter"===r&&e.push(this.clioClient.trackScreenEnter(o));return e},r.prototype.pageExit=function(){var t,e,r,o;t=this.entityStates,e=[];for(o in t)r=t[o],"enter"===r&&e.push(this.clioClient.trackScreenExit(o));return e},r.prototype.hide=function(){var t,e,r,o;t=this.entityStates,e=[];for(o in t)r=t[o],"enter"===r&&(this.entityStates[o]="hide",e.push(this.clioClient.trackScreenExit(o)));return e},r.prototype.show=function(){var t,e,r,o;t=this.entityStates,e=[];for(o in t)r=t[o],"hide"===r&&(this.entityStates[o]="enter",e.push(this.clioClient.trackScreenEnter(o)));return e},o=function(){return Math.floor(1e4*Math.random()+1)},r.configure=function(t,e,r){var o;return null==r&&(r=.5),o=new this({entityIds:t,impressionThreshold:r},{clioClient:e}),Strava.Util.Autotrack.configureImpressionTracker(o),o},r}(Backbone.Model)}.call(this);