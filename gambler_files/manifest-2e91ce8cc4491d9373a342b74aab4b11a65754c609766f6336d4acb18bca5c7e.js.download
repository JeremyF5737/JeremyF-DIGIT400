(function(){Strava.module("Strava.Ui.Global"),Strava.Ui.Global=function(){function t(){}return t.prepareAutoresizingTextbox=function(){return jQuery(document).on("focus","textarea.autoresize",function(){var t;return t=jQuery(this),t.siblings("div.textarea-clone").length?void 0:t.addClass("noresize").after("<div class='textarea-clone'></div>").bind("keydown paste",function(){return setTimeout(function(){return function(){var e,n,r;return e=t.next(),r=t.val()+"W",e.text(r),n=e.outerHeight(),t.css("height",n)}}(this),10)})})},t}()}).call(this),function(){null==window.JST&&(window.JST={}),window.JST["athletes/athlete_list_element"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<div class='media'>\n  <div class='media-object'>\n    <a class='avatar avatar-athlete avatar-sm' href='/athletes/"+e(t(this.athlete.id))+"' title='"+e(t(this.athlete.name))+"'>\n      <img class='avatar-img' src='"+e(t(this.athlete.avatar_url))+"' alt='"+e(t(this.athlete.name))+"' title='"+e(t(this.athlete.name))+"'>\n    </a>\n  </div>\n  <div class='media-content'>\n    <div class='media-body'>\n      <div class='name'>\n        <a class='athlete-name minimal' href='/athletes/"+e(t(this.athlete.id))+"'>"),n.push("          "+e(t(this.athlete.name))),this.athlete.member_type&&n.push("          <div class='app-icon-wrapper'>\n            <div class='"+["app-icon","icon-sm","icon-badge-"+e(t(this.athlete.member_type))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' title='"+e(t(Strava.I18n.Locale.t("templates.athletes.member_types."+this.athlete.member_type)))+"'></div>\n          </div>"),n.push("        </a>\n        <span class='activity-title'>"+t("&ndash; "+this.athlete.activity_link)+"</span>\n      </div>\n      <div class='location'>"+e(t(this.athlete.location))+"</div>\n    </div>\n    <div class='action-buttons media-actions'>\n      <span class='follow-action follow-button'>\n        <div class='stub'></div>\n      </span>\n    </div>\n  </div>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.AthleteListView=function(e){function n(t,e,r){this.athlete=t,this.entityId=e,this.activityAthlete=r,this.template="athletes/athlete_list_element",n.__super__.constructor.call(this)}return t(n,e),n.prototype.tagName="li",n.prototype.attributes={style:"display: none"},n.prototype.events={"click .remove-athlete":"removeAthlete"},n.prototype.render=function(){var t;return this.renderTemplate({athlete:this.athlete,entityId:this.entityId,activityAthlete:this.activityAthlete}),jQuery(this.$el).find(".follow-button").attr("data-athlete-id",this.athlete.id),this.athlete.is_following||(t=this.athlete.is_private?Strava.Follows.Factory.createFollowWithApprovalAction(this.athlete.id):Strava.Follows.Factory.createFollowAction(this.athlete.id),t.enter(this.$(".follow-button .stub"))),this},n.prototype.removeAthlete=function(){return confirm(Strava.I18n.Locale.t("templates.feed.lightbox.remove_athlete_confirm"))?jQuery.ajax({url:"/activities/"+this.entityId+"/grouping/"+this.athlete.activity_id,type:"DELETE",success:function(t){return function(){return t.$el.hide()}}(this)}):void 0},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.SocialController=function(e){function n(){this.hash={},n.__super__.constructor.call(this)}return t(n,e),n.prototype.addToHash=function(t,e){return e.length||(e=[]),this.hash[t]=e},n.prototype.addToKey=function(t,e){return null==this.hash[t]&&(this.hash[t]=[]),this.hash[t].push(e)},n.prototype.setHash=function(t){return""!==t?this.hash=t:void 0},n.prototype.getFromHash=function(t){return this.hash[t]||[]},n.prototype.existsInHash=function(t){return null!=this.hash[t]},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.AchievementsController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.fetchAchievements=function(t,e,n,r){var o;return o=t+"-"+e,this.existsInHash(o)?void n(this.getFromHash(o)):this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"achievements"),success:function(t){return function(e,r){var i;return i=r.achievements,t.addToHash(o,i),n(i)}}(this),error:function(t,e){return null!=r?r(e):void 0}})},n}(Strava.Lib.SocialController)}.call(this),function(){Strava.module("Strava.Lib"),Strava.Lib.CacheableModel={REQUEST_CACHE:{},read:function(t,e){var n,r,o;return o=t.url(),r=jQuery.Deferred(),n=Strava.Lib.CacheableModel.REQUEST_CACHE[o],null!=n?(t.set(n,e),r.resolve(n)):Backbone.sync("read",t,e).done(function(n){return t.set(n,e),Strava.Lib.CacheableModel.REQUEST_CACHE[o]=_.clone(n)}).done(function(){return r.resolve()}).fail(function(){return r.reject()}),r.promise()},sync:function(t,e,n){var r;return null==n&&(n={}),r=function(){switch(t){case"read":return n.cache?Strava.Lib.CacheableModel.read(e,n):Backbone.sync("read",e,n);case"create":throw new Error("Create not supported");case"update":throw new Error("Update not supported");case"delete":throw new Error("Delete not supported")}}(),n.success&&r.done(function(){return n.success()}),n.error&&r.fail(function(){return n.error()}),r}}}.call(this),function(){Strava.module("Strava.Lib"),Strava.Lib.EntityMap=function(){function t(){}return t.entity_map={Activity:"activity",AthleteFeedEntry:"athlete-feed-entry",Post:"post"},t.getUrl=function(t,e,n){return"/feed/"+this.entity_map[t]+"/"+e+"/"+n},t}()}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.CommentsController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(){return this.commentable=!0,jQuery(document).bind("commentCreatedFromReact",function(t){return function(e){var n,r,o;return n=e.originalEvent.detail,o=n.response,r=n.entity+"-"+n.entityId,t.addToKey(r,o),t.dispatchCommentCreate(o,r),t.dispatchCommentCompleted(r)}}(this))},n.prototype.comment=function(t,e,n){var r,o;return r={comment:n},o=t+"-"+e,this.save(null,{url:Strava.Lib.EntityMap.getUrl(t,e,"comment"),type:"POST",data:JSON.stringify(r),contentType:"application/json",success:function(t){return function(e,n){return t.addToKey(o,n),t.dispatchCommentCreate(n,o)}}(this),complete:function(t){return function(){return t.dispatchCommentCompleted(o)}}(this)})},n.prototype.dispatchCommentCreate=function(t,e){return this.trigger("commentCreated",t,e)},n.prototype.dispatchCommentCompleted=function(t){return this.trigger("commentCompleted",t)},n.prototype.dispatchCommentDelete=function(t,e){return this.trigger("commentDeleted",t,e)},n.prototype.dispatchCommentsReturned=function(t){return this.trigger("commentsReturned",t)},n.prototype.deleteComment=function(t,e){return this.fetch({url:"/feed/comment",type:"DELETE",data:JSON.stringify({id:e}),contentType:"application/json",success:function(n){return function(r,o){return n.removeCommentFromHash(t,e),n.dispatchCommentDelete(t,o)}}(this)})},n.prototype.parse=function(){return{id:1}},n.prototype.removeCommentFromHash=function(t,e){var n,r,o,i,a,s;for(r=this.getFromHash(t),s=[],o=i=0,a=r.length;a>i;o=++i){if(n=r[o],n.comment_id===e){r.splice(o,1);break}s.push(void 0)}return s},n.prototype.fetchComments=function(t,e,n,r){var o;return o=t+"-"+e,this.existsInHash(o)?void n(this.getFromHash(o)):this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"comments"),success:function(t){return function(e,r){var i;return i=r.comments,t.addToHash(o,i),n(i)}}(this),error:function(t,e){return null!=r?r(e):void 0}})},n.prototype.forceFetchComments=function(t,e){var n;return n=t+"-"+e,this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"comments"),success:function(t){return function(e,r){return t.addToHash(n,r.comments)}}(this)})},n}(Strava.Lib.SocialController)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.KudosController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.kudo=function(t,e){return this.save(null,{url:Strava.Lib.EntityMap.getUrl(t,e,"kudo"),contentType:"application/json",type:"POST",success:function(n){return function(){return n.dispatchKudosCreate(t,e)}}(this)})},n.prototype.dispatchKudosCreate=function(t,e){return this.trigger("kudoCreated",t,e)},n.prototype.fetchKudos=function(t,e,n,r){return this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"kudos"),success:function(t,e){return n(e.athletes,e.kudosable,e.isOwner)},error:function(){return r("")}})},n.prototype.parse=function(){return{id:1}},n}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/loading_box"]=function(t){return function(){var t;return t=[],t.push("<div class='centerAlign pb-lg pt-lg'>\n  <div class='sm spinner vcentered'>\n    <div class='graphic'></div>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.SocialBoxView=function(e){function n(){this.selected=!1,this.loadingTemplate="feed/loading_box"}return t(n,e),n.prototype.renderLoading=function(){return this.renderTemplate({},this.loadingTemplate)},n.prototype.unselect=function(){return this.selected=!1},n.prototype.select=function(){return this.selected=!0},n.prototype.show=function(){},n}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/achievement_box"]=function(t){return function(){var t;return t=[],t.push("<ul class='achievements list-achievements'></ul>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/achievement"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<div class='"+["app-icon","icon-sm",""+e(t(this.achievement.sprite))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'></div>\n<div class='effort'>\n  <a href='/activities/"+e(t(this.achievement.activity_id))+"/segments/"+e(t(this.achievement.id))+"'>"+e(t(this.achievement.name))+"</a>\n  <strong>"+e(t(this.achievement.description))+"</strong>"),n.push("  "+t("("+this.achievement.elapsed_time+")")),n.push("</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.AchievementsView=function(e){function n(t,e,r){this.controller=t,this.entity=e,this.entity_id=r,this.template="feed/achievement_box",n.__super__.constructor.call(this)}return t(n,e),n.prototype.render=function(t){return this.setElement(t),this.renderLoading(),this.controller.fetchAchievements(this.entity,this.entity_id,function(t){return function(e){return t.handleSuccess(e)}}(this),function(t){return function(){return t.renderEmpty()}}(this)),this},n.prototype.renderEmpty=function(){return this.renderTemplate()},n.prototype.handleSuccess=function(t){var e,n,r,o;for(this.renderEmpty(),n=[],r=0,o=t.length;o>r;r++)e=t[r],n.push(this.createAchievementElement(e));return n.length&&this.$(".achievements").append(n).find("li").fadeIn("fast"),this},n.prototype.createAchievementElement=function(t){var e;return e=new Strava.Feed.Achievement(t),e.render().el},n}(Strava.Feed.SocialBoxView),Strava.Feed.Achievement=function(e){function n(t){this.achievement=t,this.template="feed/achievement",n.__super__.constructor.call(this)}return t(n,e),n.prototype.tagName="li",n.prototype.attributes={style:"display: none"},n.prototype.render=function(){return this.renderTemplate({achievement:this.achievement}),this},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.CardEntryItemActionView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.tagName="button",n.prototype.className="btn btn-sm str-click-self-js",n.prototype.events={click:"handleClick"},n.prototype.render=function(){return"on"===this.model.actionState()?this.$el.removeClass("btn-default").addClass("btn-primary"):this.$el.removeClass("btn-primary").addClass("btn-default"),this.$el.attr("str-target-url",this.model.trackableTargetUrl()),this.$el.text(this.model.label()),this},n.prototype.isLocked=function(){return this.$el.prop("disabled")},n.prototype.lock=function(){return this.$el.prop("disabled",!0)},n.prototype.unlock=function(){return this.$el.prop("disabled",!1)},n.prototype.handleClick=function(){return this.isLocked()?void 0:(this.lock(),this.model.execute().done(function(t){return function(){return t.render()}}(this)).always(function(t){return function(){return t.unlock()}}(this)))},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.CardEntryItemView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.className="card-entry-item",n.prototype.id=function(){return this.model.get("impression_key")?this.model.get("impression_key"):void 0},n.prototype.events={"click .dismiss-action":"handleDismissAction"},n.prototype.initialize=function(){return this.create_template("#card-entry-item-template")},n.prototype.hide=function(){return this.$el.hide()},n.prototype.attachToDom=function(t){return this.setElement(t),new Strava.Feed.CardEntryItemActionView({el:this.$(".media-body .action .btn"),model:this.model.actions().first()}),this.avatar(),this},n.prototype.render=function(){var t;return this.renderTemplate({title:this.model.title(),subtitle:this.model.subtitle(),destination_url:this.model.destinationUrl(),avatar_shape:this.model.avatarShape()}),t=new Strava.Feed.CardEntryItemActionView({model:this.model.actions().first()}),this.$el.find(".media-body .action").html(t.render().el),this.avatar(),this.addTracking(),this},n.prototype.avatar=function(){return this.model.avatar().done(function(t){return function(e,n){return n.className="avatar-img",t.$(".avatar-content").html(n)}}(this))},n.prototype.addTracking=function(){var t;return this.model.get("trackable_id")?(this.$el.attr("str-trackable-id",this.model.get("trackable_id")),this.model.hasDismissAction()&&this.$(".dismiss-action").attr("str-target-url",this.model.dismissAction().trackableTargetUrl()),t={"str-on":"click","str-trackable-id":this.model.get("trackable_id")},["avatar","name","self","kudos","comment-list","photo","anchor-container"].forEach(function(e){return function(n){var r;return t["str-type"]=n.replace("-","_"),"anchor-container"===n?(r=_.extend({"click-type":"link"},t),e.$(".str-click-anchor-container-self-js").attr(r)):e.$(".str-click-"+n+"-js").attr(t)}}(this))):void 0},n.prototype.handleDismissAction=function(){return this.$el.prop("disabled")?void 0:(this.$el.prop("disabled",!0),this.model.dismissAction().execute().done(function(t){return function(){return t.trigger("cardEntryItem:dismiss")}}(this)).always(function(t){return function(){return t.$el.prop("disabled",!1)}}(this)))},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.Member=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.urlRoot=function(){return"/clubs/"+this.get("club_id")+"/members"},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.ClubJoinButtonView=function(e){function n(t,e){n.__super__.constructor.call(this,{el:t}),this.memberModel=new Strava.Models.Member(e)}return t(n,e),n.prototype.events={click:"joinClub"},n.prototype.joinClub=function(t){return t.preventDefault(),this.$el.prop("disabled",!0),this.submitRequest()},n.prototype.submitRequest=function(){return this.memberModel.save({},{success:function(t){return function(){return t.$el.val(Strava.I18n.Locale.t("strava.feed.club_join_button_view.joined"))}}(this),error:function(t){return function(){return t.$el.prop("disabled",!1),alert(Strava.I18n.Locale.t("strava.feed.club_join_button_view.error"))}}(this)})},n}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/comment_box"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<!-- / Lightbox Comments -->\n<div class='comments'>\n  <p class='no-comments'>"+e(t(Strava.I18n.Locale.t("templates.feed.comment_box.no_comments")))+"</p>\n  <ol class='thread'></ol>\n  <!-- / If the variable commentsDisable doesnt exist, or if it exists & is not true -->"),(null==this.commentsDisabled||null!=this.commentsDisabled&&!this.commentsDisabled)&&n.push("  <form class='media'>\n    <div class='media-left'>\n      <div class='avatar avatar-athlete avatar-sm'>\n        <img class='avatar-img' src='"+e(t(this.athlete.photo))+"' alt='"+e(t(this.athlete.display_name))+"' title='"+e(t(this.athlete.display_name))+"'>\n      </div>\n    </div>\n    <div class='media-content mentionable-comment-field' data-react-class='MentionableComment' data-react-props='"+e(t(JSON.stringify({entity:this.entity,buttonClasses:"btn btn-default btn-sm",entityId:this.entityId,suggestionLimit:10})))+"'></div>\n  </form>"),n.push("</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/comment_box_comment"]=function(t){return function(){var t,e,n,r,o,i,a;if(e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<div class='media-left'>\n  <a class='avatar avatar-athlete avatar-sm'>\n    <img class='avatar-img' src='"+e(t(this.athlete.avatar_url))+"' alt='"+e(t(this.athlete.name))+"' title='"+e(t(this.athlete.name))+"'>\n  </a>\n</div>\n<div class='comment media-body'>\n  <a class='athlete-name' href='/athletes/"+e(t(this.athlete.id))+"'>"+e(t(this.athlete.name))+"</a>\n  <div class='comment-text'>"),_.isString(this.comment))n.push("    "+e(t(this.comment)));else for(i=this.comment,r=0,o=i.length;o>r;r++)a=i[r],n.push("mention_token"===a.type?"    <a class='mentioned-athlete' href='"+e(t(a.path))+"'>"+e(t(a.text))+"</a>":"    "+e(t(a.text)));return n.push("  </div>\n</div>\n<div class='media-actions'>"),n.push("  "+t(this.timestamp)),n.push("  <div class='actionable'></div>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/delete_link"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<button class='btn btn-link delete' data-comment-id='"+e(t(this.comment_id))+"' title='"+e(t(Strava.I18n.Locale.t("templates.feed.delete_link_v2.delete_title")))+"'>"),n.push("  "+e(t(Strava.I18n.Locale.t("templates.feed.delete_link_v2.delete")))),n.push("</button>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/report_link"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<a class='report' href='/comments/"+e(t(this.comment_id))+"/feedback' data-comment-id='"+e(t(this.comment_id))+"'>"),n.push("  "+e(t(Strava.I18n.Locale.t("templates.feed.report_link.report")))),n.push("</a>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/quarantine_link"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<a class='report' href='"+e(t("/admin/quarantine/comment_form?comment_id="+this.comment_id))+"' target='_blank'>Quarantine</a>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.CommentBoxView=function(e){function n(t,e,r,o){this.controller=t,this.entity=e,this.entity_id=r,this.commentsDisabled=o,this.template="feed/comment_box",this.controller.bind("commentCreated",function(t){return function(e){var n,r;return r=t.createCommentElem(e),t.$("p.no-comments").remove(),n=t.$("ol.thread"),n.length?(n.scrollTop(n[0].scrollHeight),n.append(r).find("li").slideDown(),t.$("form textarea").val("")):void 0}}(this)),this.controller.bind("commentCompleted",function(t){return function(){return t.$("form input[type='submit']").removeAttr("disabled")}}(this)),n.__super__.constructor.call(this)}return t(n,e),n.prototype.events={"submit form":"createComment"},n.prototype.createCommentElem=function(t){var e;return e=new Strava.Feed.CommentBoxComment(this.controller,t,this.entity,this.entity_id),e.render().el},n.prototype.createComment=function(){var t;return t=jQuery.trim(this.$("form textarea").val()),t.length&&(this.$("form input[type='submit']").attr("disabled","disabled"),this.controller.comment(this.entity,this.entity_id,t,{})),!1},n.prototype.render=function(t){return this.setElement(t),this.renderLoading(),this.controller.fetchComments(this.entity,this.entity_id,function(t){return function(e){return t.handleSuccess(e)}}(this),function(t){return function(){return t.renderEmpty()}}(this)),this},n.prototype.renderEmpty=function(){return this.renderTemplate({athlete:currentAthlete.toJSON(),entity:this.entity,entityId:this.entity_id,commentsDisabled:this.commentsDisabled}),this.controller.commentable?this.$("textarea").focus():this.$("form").hide()},n.prototype.handleSuccess=function(t){var e,n,r,o,i,a;for(this.renderEmpty(),r=[],o=0,i=t.length;i>o;o++)e=t[o],r.push(this.createCommentElem(e));return r.length&&(this.$(".no-comments").remove(),this.$("ol.thread").append(r).find("li").fadeIn("fast")),a=this.$(".mentionable-comment-field"),a.length&&(n=new CustomEvent("JSCreatedReactNode",{detail:{node:a}}),document.dispatchEvent(n)),this},n}(Strava.Feed.SocialBoxView),Strava.Feed.CommentBoxComment=function(e){function n(t,e,r,o){this.controller=t,this.comment=e,this.entity=r,this.entity_id=o,this.template="feed/comment_box_comment",this.thread_key=this.entity+"-"+this.entity_id,n.__super__.constructor.call(this)}return t(n,e),n.prototype.tagName="li",n.prototype.className="media",n.prototype.attributes={style:"display: none"},n.prototype.events={"click .delete":"deleteComment","click .report":"reportComment"},n.prototype.deleteComment=function(){return Strava.ExternalAnalytics.trackV2({category:this.analyticsCategory(),page:"comment",action:"click",element:"delete",properties:this.analyticsPropertiesForComment}),confirm(Strava.I18n.Locale.t("strava.feed.comment_box_view.confirm_delete"))&&(Strava.ExternalAnalytics.trackV2({category:this.analyticsCategory(),page:"comment",action:"click",element:"confirm_delete",properties:this.analyticsPropertiesForComment}),this.controller.deleteComment(this.thread_key,this.comment.comment_id),this.$el.slideUp("fast",function(t){return function(){return t.remove()}}(this))),!1},n.prototype.reportComment=function(t){return t.preventDefault(),Strava.ExternalAnalytics.trackV2({category:this.analyticsCategory(),page:"comment",action:"click",element:"report",properties:this.analyticsPropertiesForComment()}),window.location=jQuery(t.target).attr("href")},n.prototype.analyticsPropertiesForComment=function(){var t;switch(t={comment_id:this.comment.comment_id},this.entity){case"Activity":t.activity_id=this.entity_id;break;case"Post":t.post_id=this.entity_id}return t},n.prototype.analyticsCategory=function(){var t;return t=window.location.href,-1!==t.indexOf("posts")?"post_detail":-1!==t.indexOf("activities")?"activity_detail":-1!==t.indexOf("athletes")?"athlete_profile":-1!==t.indexOf("running-races")?"running_race":"feed"},n.prototype.render=function(){var t,e,n,r,o,i,a,s,c,l,u;for(this.renderTemplate({athlete:this.comment.athlete,comment:this.comment.comment,timestamp:this.comment.timestamp}),c=this.$("time.timeago"),i=0,a=c.length;a>i;i++)o=c[i],e=this.$(o),(n=e.attr("datetime"))&&(u=Strava.I18n.TimespanFormatter.timeago(Date.parse(n)),e.html(u));return(this.comment.reportable||this.comment.deletable||this.comment.quarantinable)&&(t=this.$el.find(".actionable"),this.comment.reportable&&(l=this.getTemplateFor("feed/report_link"),t.append(l({comment_id:this.comment.comment_id}))),this.comment.deletable&&(r=this.getTemplateFor("feed/delete_link"),t.append(r({comment_id:this.comment.comment_id}))),this.comment.quarantinable&&(s=this.getTemplateFor("feed/quarantine_link"),t.append(s({comment_id:this.comment.comment_id})))),this},n}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/comment_feed"]=function(t){return function(){var t,e,n,r,o,i,a;if(e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<div class='media-left'>\n  <div class='avatar avatar-athlete avatar-sm'>\n    <a class='avatar-content' href='/athletes/"+e(t(this.athlete.id))+"'>\n      <div class='avatar-img-wrapper'>"),this.athlete.member_type&&n.push("        <div class='avatar-badge'>\n          <span class='app-icon-wrapper'>\n            <span class='"+["app-icon","icon-sm","icon-badge-"+e(t(this.athlete.member_type))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'></span>\n          </span>\n        </div>"),n.push("        <img class='avatar-img' src='"+e(t(this.athlete.photo))+"' alt='"+e(t(this.athlete.display_name))+"'>\n      </div>\n    </a>\n  </div>\n</div>\n<div class='comment media-body'>\n  <a class='athlete-name' href='/athletes/"+e(t(this.athlete.id))+"'>"+e(t(this.athlete.display_name))+"</a>\n  <span class='comment-text'>"),_.isString(this.comment))n.push("    "+e(t(this.comment)));else for(i=this.comment,r=0,o=i.length;o>r;r++)a=i[r],n.push("mention_token"===a.type?"    <a class='mentioned-athlete' href='"+e(t(a.path))+"'>"+e(t(a.text))+"</a>":"    "+e(t(a.text)));return n.push("  </span>\n  <div class='comment-actionable'>\n    <span class='timestamp'>"),n.push("      "+t(this.timestamp)),n.push("    </span>"),(this.deletable||this.reportable)&&(n.push("    <div class='comment-actions'>"),this.reportable&&(n.push("      <span class='report-comment'>\n        <a class='report' href='/comments/"+e(t(this.comment_id))+"/feedback' data-comment-id='"+e(t(this.comment_id))+"'>"),n.push("          "+e(t(Strava.I18n.Locale.t("templates.feed.comment_feed.report")))),n.push("        </a>\n      </span>")),this.deletable&&(n.push("      <span class='delete-comment'>\n        <button class='btn btn-link delete' data-comment-id='"+e(t(this.comment_id))+"'>"),n.push("          "+e(t(Strava.I18n.Locale.t("templates.feed.comment_feed.delete")))),n.push("        </button>\n      </span>")),n.push("    </div>")),n.push("  </div>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.EntityView=function(e){function n(t,e){this.commentsController=t,this.kudosController=e,this.prepareResponseBindings(),this.prepareFeedBindings(),n.__super__.constructor.call(this)}return t(n,e),n.prototype.prepareResponseBindings=function(){return this.commentsController.bind("commentCreated",function(t){return function(e,n){var r,o,i;return r=jQuery("#"+n),o=r.find(".comments ol.thread"),o.length&&(i=jQuery(new Strava.Feed.Comment(e).render().el),o.append(i)),r.find(".comments form textarea").val(""),t.updateCommentCount(n,1)}}(this)),this.commentsController.bind("commentCompleted",function(){return function(t){var e;return e=jQuery("#"+t),e.find(".comments form input[type='submit']").removeAttr("disabled")}}(this)),this.commentsController.bind("commentDeleted",function(t){return function(e,n){var r;return r=jQuery("[data-entity-id="+e+"]").find("ol.thread [data-comment-id='"+n.id+"']"),r.closest("li").remove(),t.updateCommentCount(e,-1)}}(this)),this.kudosController.bind("kudoCreated",function(){return function(t,e){var n,r,o,i;return i=t+"-"+e,o=jQuery("#"+i),o.find(".btn-kudo").removeClass("empty js-add-kudo").addClass("kudoed js-view-kudos").attr("title",Strava.I18n.Locale.t("strava.feed.entity_view.view_all_kudos")),o.find(".btn-kudo .app-icon").removeClass("icon-dark").addClass("kudoed icon-color").end(),o.find(".kudos-facepile .avatar.hidden").removeClass("hidden").end(),o.find(".kudos-count-wrapper").removeClass("empty js-add-kudo").end(),o.find(".js-give-kudos-cta").addClass("hidden").end(),n=o.find(".count-kudos"),r=n.data("kudo-count")+1,n.data("kudo-count",r),n.text(r)}}(this))},n.prototype.prepareFeedBindings=function(){return jQuery(".page").on("submit",".feed .comments form",function(t){return function(e){var n,r,o;return n=jQuery(e.target),r=n.data("entry"),o=n.find("textarea").val(),o.length&&(n.find("input[type='submit']").attr("disabled","disabled"),t.commentsController.comment(r[0],r[1],o)),!1}}(this)).on("click",".feed .js-add-kudo",function(t){return function(e){var n,r;return n=jQuery(e.currentTarget),r=n.data("entry"),r&&(n.addClass("kudoed"),t.kudosController.kudo(r[0],r[1])),!1}}(this)).on("click",".feed .comments ol.thread .delete-comment",function(t){return function(e){var n,r;return n=jQuery(e.target),Strava.ExternalAnalytics.trackV2({category:t.analyticsCategory(),page:"comment",action:"click",element:"delete",properties:t.analyticsPropertiesForComment(n)}),confirm(Strava.I18n.Locale.t("strava.feed.comment_box_view.confirm_delete"))&&(Strava.ExternalAnalytics.trackV2({category:t.analyticsCategory(),page:"comment",action:"click",element:"confirm_delete",properties:t.analyticsPropertiesForComment(n)}),r=n.closest("[data-entity-id]").data("entity-id"),t.commentsController.deleteComment(r,n.data("comment-id"))),!1}}(this)).on("click",".feed .comments ol.thread .report-comment",function(t){return function(e){var n;return e.preventDefault(),n=jQuery(e.target),Strava.ExternalAnalytics.trackV2({category:t.analyticsCategory(),page:"comment",action:"click",element:"report",properties:t.analyticsPropertiesForComment(n)}),window.location=n.attr("href")
}}(this))},n.prototype.analyticsPropertiesForComment=function(t){var e,n,r,o,i;switch(e=t.closest("[data-entity-id]").data("entity-id"),n=e.split("-"),o=n[0],r=parseInt(n[1]),i={comment_id:t.data().commentId},o){case"Activity":i.activity_id=r;break;case"Post":i.post_id=r}return i},n.prototype.analyticsCategory=function(){var t;return t=window.location.href,-1!==t.indexOf("posts")?"post_detail":-1!==t.indexOf("activities")?"activity_detail":-1!==t.indexOf("athletes")?"athlete_profile":"feed"},n.prototype.updateCommentCount=function(t){var e,n,r,o;return r=jQuery("#"+t),e=r.find(".count-comments"),o=r.find(".js-view-comments .count-label"),n=this.commentsController.getFromHash(t).length,0===n?(e.parent().addClass("empty"),e.parents().find(".comments-count-wrapper").addClass("empty"),e.closest(".social").find(".show-all").hide()):(e.parent().removeClass("empty"),e.parents().find(".comments-count-wrapper").removeClass("empty")),o.html(Strava.I18n.Locale.t("strava.feed.comment_count",{count:n})),e.html(n),r.find(".link-count").text(n)},n}(Backbone.View),Strava.Feed.Comment=function(e){function n(t){this.data=t,this.template="feed/comment_feed",n.__super__.constructor.call(this)}return t(n,e),n.prototype.tagName="li",n.prototype.className="deletable media",n.prototype.render=function(){var t,e,n,r,o,i,a;for(this.renderTemplate({athlete:currentAthlete.toJSON(),comment:this.data.comment,comment_id:this.data.comment_id,timestamp:this.data.timestamp,deletable:this.data.deletable,reportable:this.data.reportable,quarantinable:this.data.quarantinable}),i=this.$("time.timeago"),r=0,o=i.length;o>r;r++)n=i[r],t=this.$(n),(e=t.attr("datetime"))&&(a=Strava.I18n.TimespanFormatter.timeago(Date.parse(e)),t.html(a));return this},n}(Backbone.View)}.call(this),function(){Strava.module("Strava.Util"),Strava.Util.ClioAdapter=function(){function t(t){this.clioClient=t,this.loggingEnabled=!1}return t.prototype.trackClick=function(t,e,n){var r,o,i;return this.log("%ctrackClick %O",arguments,"color: blue; font-size: large;"),o="kudos"===e?Strava.Analytics.Models.ClientEvent.newKudo(t):"comment"===e?Strava.Analytics.Models.ClientEvent.newComment(t):(i=Strava.Analytics.Models.ClientEvent.TargetType,r=function(){switch(e){case"self":return i.SELF;case"link":return i.LINK;case"photo":return i.PHOTO;case"avatar":return i.OWNER_AVATAR;case"name":return i.OWNER_NAME;case"map":return i.MAP;case"comment_list":return i.COMMENT_LIST;case"share":return i.SHARE;case"join":return i.JOIN;case"perk":return i.PREMIUM_PERK;case"partner_link":return i.PARTNER_LINK;case"partner_tag":return i.PARTNER_TAG;case"partner_tag_expanded":return i.PARTNER_TAG_EXPANDED;default:return i.SELF}}(),Strava.Analytics.Models.ClientEvent.newClick(t).setTargetType(r)),n&&o.setTargetUrl(n),this.track(o)},t.prototype.trackScreenExit=function(t){return this.log("%ctrackScreenExit %O",arguments,"color: red; font-size: large;"),this.track(Strava.Analytics.Models.ClientEvent.newScreenExit(t))},t.prototype.trackScreenEnter=function(t){return this.log("%ctrackScreenEnter %O",arguments,"color: green; font-size: large;"),this.track(Strava.Analytics.Models.ClientEvent.newScreenEnter(t))},t.prototype.log=function(t,e,n){return this.loggingEnabled?console.log(t,n,e):void 0},t.prototype.track=function(t){return t.setClientUrl(window.location.href),this.clioClient.track(t)},t}()}.call(this),function(){Strava.module("Strava.Tracking"),Strava.Tracking.ImpressionTrackerSet=function(){function t(){this.trackers={}}return t.prototype.addTracker=function(t,e){return this.trackers[t]?void 0:this.trackers[t]={tracker:t,ga:e}},t.prototype.pageEnter=function(){var t,e,n,r;n=this.trackers,r=[];for(e in n)t=n[e],r.push(t.tracker.pageEnter());return r},t.prototype.pageExit=function(){var t,e,n,r;n=this.trackers,r=[];for(e in n)t=n[e],r.push(t.tracker.pageExit());return r},t.prototype.hide=function(){var t,e,n,r;n=this.trackers,r=[];for(e in n)t=n[e],r.push(t.tracker.hide());return r},t.prototype.show=function(){var t,e,n,r;n=this.trackers,r=[];for(e in n)t=n[e],r.push(t.tracker.show());return r},t.prototype.count=function(){return Object.keys(this.trackers).length},t.prototype.reset=function(){var t,e,n;n=this.trackers;for(e in n)t=n[e],t.tracker.pageExit(),t.ga.remove();return this.trackers={}},t}()}.call(this),function(){Strava.module("Strava.Util"),Strava.Util.Autotrack=function(){function t(){this.impressionTrackerSet=new Strava.Tracking.ImpressionTrackerSet,this.pageVisibilityTracker=null}var e,n;return e=1440,t.prototype.setPageVisibilityTracker=function(t){return this.pageVisibilityTracker=t,this.pageVisibilityTracker.on("pageEnter",function(t){return function(){return t.impressionTrackerSet.pageEnter()}}(this)),this.pageVisibilityTracker.on("pageExit",function(t){return function(){return t.impressionTrackerSet.pageExit()}}(this))},t.prototype.addImpressionTracker=function(t,e){return this.impressionTrackerSet.addTracker(t,e)},t.prototype.setClioTracker=function(t){return this.clioTracker=t},t.prototype.getClioTracker=function(){return this.clioTracker},t.prototype.handleUnload=function(){return this.impressionTrackerSet.pageExit()},t.prototype.handleImpressionReset=function(){return this.impressionTrackerSet.reset()},t.prototype.handleImpressionHide=function(){return this.impressionTrackerSet.hide()},t.prototype.handleImpressionShow=function(){return this.impressionTrackerSet.show()},t.prototype.handleImpressionAppend=function(t){return Strava.Feed.ImpressionTracker.configure(t,this.clioTracker)},n=null,t.getInstance=function(){return n||(n=new this),n},t.configureImpressionTracker=function(t){var e;return e=this.createPlugin("ImpressionTracker",t,{attributePrefix:"str-",elements:t.entities()}),this.getInstance().addImpressionTracker(t,e)},t.configurePageVisibilityTracker=function(t){return this.createPlugin("PageVisibilityTracker",t,{changeTemplate:function(t,e){return e},sessionTimeout:e}),this.getInstance().setPageVisibilityTracker(t)},t.configureEventTracker=function(t){return this.createPlugin("EventTracker",t,{attributePrefix:"str-"})},t.createPlugin=function(t,e,n){return"undefined"!=typeof gaplugins&&null!==gaplugins?new gaplugins[t](e,n):(console.log("gaplugins not found"),null)},t.configurePage=function(t,e,n){var r,o;return r={remote_logger:{request_headers:{"X-CSRF-Token":t}}},o=this.getInstance(),Strava.Analytics.initialize(e,r).then(function(t){var e;return e=new Strava.Util.ClioAdapter(t),o.setClioTracker(e),n(e,o)})},t.configureMore=function(t){var e;return e=this.getInstance(),t(e.getClioTracker())},t}()}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.EventTracker=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(t,e){return this.clioClient=e.clioClient},n.prototype.send=function(t,e){return"anchor_container"===e.type?this.handleAnchorContainer(t,e):this.clioClient.trackClick(e.trackableId,e.type,e.targetUrl)},n.prototype.handleAnchorContainer=function(t,e){var n;if("A"===e.targetTagName)return n=e.click_type?e.click_type:"link",this.clioClient.trackClick(e.trackableId,n,e.targetUrl)},n.configure=function(t){var e;return e=new this({},{clioClient:t}),Strava.Util.Autotrack.configureEventTracker(e)},n}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["performance_goals/tooltip"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<div id='js-snw-performance-goals-upsell'>\n  <a class='dismiss' href='javascript:;'>"),n.push("    "+e(t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.dismiss")))),n.push("  </a>\n  <h4 class='h5 title'>\n    <div class='badge premium sm'></div>"),n.push("    "+e(t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.goals")))),n.push("  </h4>\n  <div class='content'>"),n.push("    "+t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.upsell_v3_html"))),n.push("  </div>\n  <div class='arrow bottom'></div>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Ui"),Strava.Ui.TooltipView=function(e){function n(t){n.__super__.constructor.call(this),JST[t]?this.template=t:this.createTemplate(t)}return t(n,e),n.prototype.tagName="div",n.prototype.className="super-tooltip",n.prototype.attributes={style:"display: none"},n.prototype.events={"click .dismiss":"dismissTooltip"},n.prototype.render=function(t,e){return this.renderTemplate({data:this.prepareData(t)}),this.delegateEvents(),this.show(e),this},n.prototype.prepareData=function(t){return t},n.prototype.show=function(t){var e,n,r,o,i,a;return this.$$(".super-tooltip").remove(),this.$$("body").append(this.el),n=this.$$(t),a=n.offset(),e=this.$("div.arrow"),o=e.hasClass("top")?a.top+n.outerHeight()+10:a.top-(this.$el.height()+15),i=!1,0>o?(o=0,i=!0):o+this.$el.outerHeight()>this.$$(window).height()+window.pageYOffset&&(o=this.$$(window).height()+window.pageYOffset-this.$el.outerHeight(),i=!0),r=a.left-this.$el.width()/2+n.outerWidth()/2,0>r?(r=0,i=!0):r+this.$el.outerWidth()>this.$$(window).width()+window.pageXOffset&&(r=this.$$(window).width()+window.pageXOffset-this.$el.outerWidth(),i=!0),i&&e.hide(),this.$el.css({left:r,top:o}),this.$el.fadeIn("fast")},n.prototype.dismissTooltip=function(){return this.$el.remove(),!1},n.createInstance=function(t,e){return null==this.instance&&(this.instance=new e(t),this.instance.$document().click(function(t){return function(e){return t.instance.$el.is(":visible")&&!jQuery(e.target).parents(".super-tooltip").length?t.instance.dismissTooltip():void 0}}(this))),this.instance},n.show=function(t,e){return this.instance.render(t,e)},n}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/goal_tooltip"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<a class='dismiss'>"+e(t(Strava.I18n.Locale.t("templates.feed.goal_tooltip.dismiss")))+"</a>\n<h4 class='h5 title'>\n  <div class='badge premium sm'></div>"),n.push("  "+e(t(Strava.I18n.Locale.t("templates.feed.goal_tooltip.title")))),n.push("</h4>\n<div class='content'>"),n.push("  "+t(Strava.I18n.Locale.t("templates.feed.goal_tooltip.upgrade_v2_html",{url:"/premium/?source=progress-goals#goals"}))),n.push("</div>\n<div class='arrow bottom'></div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.GoalTooltipView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.prepareData=function(t){return{name:t.athlete_firstname}},n.createInstance=function(){return Strava.Ui.TooltipView.createInstance("feed/goal_tooltip",this)},n.show=function(t,e){return Strava.Ui.TooltipView.show(t,e)},n}(Strava.Ui.TooltipView)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.GroupRideController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.fetchGroupAthletes=function(t,e,n,r){return this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"group_athletes"),success:function(t,e){return n(e.athletes)},error:function(){return r("")}})},n.prototype.parse=function(){return{id:1}},n}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/group_ride"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<ul class='athletes list-athletes list-media'></ul>"),parseInt(this.activityAthlete.id,10)===currentAthlete.id&&(n.push("<div class='actions actions-kudo modal-footer'>\n  <button class='btn btn-default compact' id='leave-group'>"),n.push("    "+e(t(Strava.I18n.Locale.t("templates.feed.lightbox.leave_group")))),n.push("  </button>\n</div>")),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.GroupRideView=function(e){function n(t,e,r,o){this.controller=t,this.entity=e,this.entityId=r,this.activityAthlete=o,this.loadingTemplate="feed/loading_box",this.groupTemplate="feed/group_ride",n.__super__.constructor.call(this)}return t(n,e),n.prototype.events={"click #leave-group":"leaveGroup"},n.prototype.render=function(t){return this.setElement(t),this.renderTemplate({},this.loadingTemplate),this.controller.fetchGroupAthletes(this.entity,this.entityId,function(t){return function(e){return t.handleSuccess(e)}}(this),function(t){return function(e){return t.handleError(e)}}(this)),this},n.prototype.handleSuccess=function(t){var e,n,r,o;if(!this.selected)return this;for(this.renderTemplate({activityAthlete:this.activityAthlete},this.groupTemplate),n=[],r=0,o=t.length;o>r;r++)e=t[r],n.push(this.createAthleteElem(e));return n.length&&this.$("ul.athletes").append(n).find("li").fadeIn("fast"),this},n.prototype.handleError=function(){},n.prototype.createAthleteElem=function(t){var e;return e=new Strava.AthleteListView(t,this.entityId,this.activityAthlete),e.render().el},n.prototype.unselect=function(){return this.selected=!1},n.prototype.select=function(){return this.selected=!0},n.prototype.show=function(){},n.prototype.leaveGroup=function(){return Strava.ExternalAnalytics.trackV2({category:"leave_group_activity",page:"group_ride_view",action:"click",element:"leave-group"}),jQuery.ajax({url:"/activities/"+this.entityId+"/grouping",type:"DELETE",success:function(t){return function(){return t.$el.hide()}}(this)})},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.ImpressionTracker=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var r;return t(n,e),n.prototype.initialize=function(t,e){return this.clioClient=e.clioClient,this.entityStates={},this.id=r()},n.prototype.toString=function(){return"<ImpressionTracker"+this.id+">"},n.prototype.entities=function(){var t,e,n,r,o,i;for(i=this.get("impressionThreshold"),r=this.get("entityIds"),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push({trackFirstImpressionOnly:!1,threshold:i,id:t});return o},n.prototype.send=function(t,e){var n;return n=e.eventVisible,n?(this.entityStates[e.trackableId]="enter",this.clioClient.trackScreenEnter(e.trackableId)):(this.entityStates[e.trackableId]="exit",this.clioClient.trackScreenExit(e.trackableId))},n.prototype.pageEnter=function(){var t,e,n,r;t=this.entityStates,e=[];for(r in t)n=t[r],"enter"===n&&e.push(this.clioClient.trackScreenEnter(r));return e},n.prototype.pageExit=function(){var t,e,n,r;t=this.entityStates,e=[];for(r in t)n=t[r],"enter"===n&&e.push(this.clioClient.trackScreenExit(r));return e},n.prototype.hide=function(){var t,e,n,r;t=this.entityStates,e=[];for(r in t)n=t[r],"enter"===n&&(this.entityStates[r]="hide",e.push(this.clioClient.trackScreenExit(r)));return e},n.prototype.show=function(){var t,e,n,r;t=this.entityStates,e=[];for(r in t)n=t[r],"hide"===n&&(this.entityStates[r]="enter",e.push(this.clioClient.trackScreenEnter(r)));return e},r=function(){return Math.floor(1e4*Math.random()+1)},n.configure=function(t,e,n){var r;return null==n&&(n=.5),r=new this({entityIds:t,impressionThreshold:n},{clioClient:e}),Strava.Util.Autotrack.configureImpressionTracker(r),r},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.Cohort=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(){return this.deferred=null},n.prototype.url=function(){return"/athlete/experiments/"+this.id+"/cohort"},n.prototype.cohort=function(){return this.deferred||(this.deferred=this.save()),this.deferred},n}(Backbone.Model)}.call(this),Strava.module("Strava"),Strava.Experiments=function(){var t={};return{cohort:function(e){return t[e]||(t[e]=new Strava.Models.Cohort({id:e})),t[e].cohort()}}}(),function(){null==window.JST&&(window.JST={}),window.JST["feed/kudo_box_layout"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<ul class='list-athletes list-kudos' id='kudo-list'></ul>\n<div class='actions actions-kudo modal-footer' style='display: none;'>\n  <button class='btn btn-default compact create-kudo' disabled='disabled'>"),n.push("    "+e(t(Strava.I18n.Locale.t("templates.feed.kudo_box_layout.give_kudos")))),n.push("  </button>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/kudo_current_athlete"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<li class='current-athlete'>\n  <div class='media'>\n    <div class='media-object'>\n      <a class='avatar avatar-athlete avatar-sm' href='/athletes/"+e(t(this.athlete.id))+"' title='"+e(t(this.athlete.display_name))+"'>\n        <img class='avatar-img' src='"+e(t(this.athlete.photo))+"' alt='"+e(t(this.athlete.display_name))+"' title='"+e(t(this.athlete.display_name))+"'>\n      </a>\n    </div>\n    <div class='media-content'>\n      <div class='media-body'>\n        <span class='name'>\n          <a class='athlete-name minimal' href='/athletes/"+e(t(this.athlete.id))+"'>"),n.push("            "+e(t(this.athlete.display_name))),this.athlete.member_type&&n.push("            <div class='app-icon-wrapper'>\n              <div class='"+["app-icon","icon-sm","icon-badge-"+e(t(this.athlete.member_type))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' title='"+e(t(Strava.I18n.Locale.t("templates.athletes.member_types."+this.athlete.member_type)))+"'></div>\n            </div>"),n.push("          </a>\n        </span>\n        <span class='location'>"+e(t(this.athlete.display_location))+"</span>\n      </div>\n    </div>\n  </div>\n</li>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/no_kudos"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<p class='no-kudos'>"+e(t(Strava.I18n.Locale.t("templates.feed.no_kudos.no_kudos_yet_v2")))+"</p>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.KudoBoxView=function(e){function n(t,e,r){this.controller=t,this.entity=e,this.entity_id=r,this.kudoTemplate="feed/kudo_box_layout",this.noKudosTemplate="feed/no_kudos",this.currentAthleteTemplate="feed/kudo_current_athlete",this.controller.bind("kudoCreated",function(t){return function(){return t.handleKudoCreate()}}(this)),n.__super__.constructor.call(this)}return t(n,e),n.prototype.events={'click .create-kudo:not([disabled="disabled"])':"createKudo"},n.prototype.render=function(t){return this.setElement(t),this.renderLoading(),this.controller.fetchKudos(this.entity,this.entity_id,function(t){return function(e,n,r){return t.handleSuccess(e,n,r)}}(this),function(t){return function(e){return t.handleError(e)}}(this)),this},n.prototype.handleSuccess=function(t,e,n){var r,o,i,a;if(!this.selected)return this;for(this.renderTemplate({},this.kudoTemplate),r=[],o=0,a=t.length;a>o;o++)i=t[o],r.push(this.createAthleteElem(i));return r.length?this.$("#kudo-list").append(r).find("li").fadeIn("fast"):this.handleEmptyList(),n||this.$(".actions").slideDown("fast"),e&&this.$(".create-kudo").removeAttr("disabled"),this},n.prototype.handleEmptyList=function(){var t;return t=this.getTemplateFor(this.noKudosTemplate),this.$("#kudo-list").closest("#tab-contents").prepend(t({}))},n.prototype.handleError=function(){},n.prototype.createKudo=function(){return this.controller.kudo(this.entity,this.entity_id),!1},n.prototype.handleKudoCreate=function(){var t,e;if(this.selected)return t=this.$("#kudo-list"),e=this.getTemplateFor(this.currentAthleteTemplate),t.append(e({athlete:currentAthlete.toJSON()})),this.$(".no-kudos").remove(),this.$("button.create-kudo").addClass("kudoed").attr("disabled","disabled")},n.prototype.createAthleteElem=function(t){var e;return e=new Strava.AthleteListView(t),e.render().el},n.prototype.handleSegmentTracking=function(t){return Strava.ExternalAnalytics.track("Kudos Show",{experiment_name:t.experiment_name,cohort:t.cohort,view_source:"lightbox",entity:this.entity,entity_id:this.entity_id}),this.$("#kudo-list").find(".follow-action a").each(function(e){return function(n,r){var o;return o=e.$(r),e.addFollowActionTracking(o,t,o.data("state"),o.parent().data("athlete-id"))}}(this)),this.$("#kudo-list").on("followActionChanged",".follow-action",function(e){return function(n){var r;return r=e.$(n.target).find("a"),e.addFollowActionTracking(r,t,r.data("state"),r.parent().data("athlete-id"))}}(this))},n.prototype.addFollowActionTracking=function(t,e,n,r){return Strava.ExternalAnalytics.trackLink(t,"Athlete Follow",{experiment_name:e.experiment_name,cohort:e.cohort,athlete_id:r,action:n})},n}(Strava.Feed.SocialBoxView)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.PageVisibilityTracker=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.send=function(t,e){if("event"===t){if("visible"===e.eventLabel)return this.trigger("pageEnter");if("hidden"===e.eventLabel)return this.trigger("pageExit")}},n.configure=function(){var t;return t=new this,Strava.Util.Autotrack.configurePageVisibilityTracker(t)},n}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/lightbox"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<header class='modal-header'>\n  <div class='avatar avatar-athlete avatar-sm mr-sm pull-left'>\n    <img class='avatar-img' src='"+e(t(this.data.athlete_avatar))+"' alt='"+e(t(this.data.athlete_name))+"' title='"+e(t(this.data.athlete_name))+"'>\n  </div>\n  <h3 class='lightbox-title'>"+e(t(this.data.title))+"</h3>\n</header>\n<ul class='bottomless tabs topless' id='lightbox-tabs'>\n  <li id='kudos'>\n    <a class='tab'>"),n.push("      "+e(t(Strava.I18n.Locale.t("templates.feed.lightbox.kudos")))),n.push("      <span class='kudo_text' data-current-count='"+e(t(this.data.kudo_count))+"'>"+e(t(this.data.kudo_text))+"</span>\n    </a>\n  </li>\n  <li id='comments'>\n    <a class='tab'>"),n.push("      "+e(t(Strava.I18n.Locale.t("templates.feed.lightbox.comments")))),n.push("      <span class='comment_text'>"+e(t(this.data.comment_text))+"</span>\n    </a>\n  </li>\n  <li id='achievements' style='display: none'>\n    <a class='tab'>"+e(t(Strava.I18n.Locale.t("templates.feed.lightbox.achievements",{achievements_count:this.data.achievements_count})))+"</a>\n  </li>\n  <li id='group-athletes' style='display: none'>\n    <a class='tab'>"+e(t(Strava.I18n.Locale.t("templates.feed.lightbox.other_athletes")))+"</a>\n  </li>\n</ul>\n<div class='modal-body' id='tab-contents'>\n  <div class='centerAlign'>\n    <div class='sm spinner'>\n      <div class='graphic'></div>\n      <span class='status'></span>\n    </div>\n  </div>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.PopoverBoxView=function(e){function n(t,e,r,o){this.template="feed/lightbox",this.lightbox=new Strava.Ui.LightboxView,this.commentsController=t,this.kudosController=e,this.achievementsController=r,this.groupRideController=o,this.commentsController.bind("commentCreated",function(t){return function(e,n){return t.updateCommentCount(n)}}(this)).bind("commentDeleted",function(t){return function(e){return t.updateCommentCount(e)}}(this)),this.kudosController.bind("kudoCreated",function(t){return function(){return t.updateKudoCount()}}(this)),n.__super__.constructor.call(this)}var r,o;return t(n,e),r={},o={},n.prototype.render=function(t,e,n,r,o,i,a,s){return null==a&&(a=!0),this.setElement("<div></div>"),this.renderTemplate(this.getModelJson(t,e,n)),this.lightbox.render(this.el),this.createTabs(t,e,r,o,i,a,s,n.comments_disabled),this},n.prototype.getModelJson=function(t,e,n){var r;return r=t+"-"+e,n.comment_text=this.getCommentTabText(r,n),n.kudo_count||(n.kudo_count=this.getDOMKudoCount(r)),n.kudo_text=n.kudo_count>0?"("+n.kudo_count+")":"",this.achievementsController&&!n.achievements_count&&(n.achievements_count=this.achievementsController.getFromHash(r).length),{data:n}},n.prototype.getCommentTabText=function(t,e){var n;return null==e&&(e={}),n=e.comment_count||this.commentsController.getFromHash(t).length,n>0?"("+n+")":""},n.prototype.getDOMKudoCount=function(t){return this.$$(".feed #"+t+" .count-kudos").data("kudo-count")},n.prototype.updateKudoCount=function(){var t,e;return t=this.$(".kudo_text"),e=parseInt(t.data("current-count")||0,10),t.html("("+(e+1)+")")},n.prototype.updateCommentCount=function(t){var e;return e=this.getCommentTabText(t),this.$("span.comment_text").html(e)},n.prototype.createTabs=function(t,e,n,r,o,i,a,s){var c,l,u,p,d,h;return null==i&&(i=!0),l=p=c=u=!1,"comments"===n?l=!0:"kudos"===n?p=!0:"achievements"===n?c=!0:u=!0,h=[],h.push({selector:"li#comments",renderer:this.commentBoxView(t,e,s),selected:l}),i?(h.push({selector:"li#kudos",renderer:this.kudoBoxView(t,e),selected:p}),this.$("li#kudos").show()):this.$("li#kudos").hide(),r&&(h.push({selector:"li#achievements",renderer:new Strava.Feed.AchievementsView(this.achievementsController,t,e),selected:c}),this.$("li#achievements").show()),o&&(h.push({selector:"li#group-athletes",renderer:new Strava.Feed.GroupRideView(this.groupRideController,t,e,a),selected:u}),this.$("li#group-athletes").show()),d=new Strava.Ui.TabController(h,"#lightbox-tabs"),d.render()},n.prototype.commentBoxView=function(t,e,n){var o;return o=t+"-"+e,r[o]||(r[o]=new Strava.Feed.CommentBoxView(this.commentsController,t,e,n)),r[o]},n.prototype.kudoBoxView=function(t,e){var n;return n=t+"-"+e,o[n]||(o[n]=new Strava.Feed.KudoBoxView(this.kudosController,t,e)),o[n]},n.show=function(t,e,n,r,o,i,a){return null==r&&(r="comments"),null==o&&(o=!1),null==i&&(i=!1),this.instance.render(t,e,n,r,o,i,!0,a)},n.createInstance=function(t,e,n,r){return this.instance=new Strava.Feed.PopoverBoxView(t,e,n,r)},n}(Backbone.View),Strava.Feed.PopoverBoxActivityView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.getDOMKudoCount=function(){return this.$$("#kudos .count").data("count")},n.createInstance=function(t,e,n,r){return this.instance=new Strava.Feed.PopoverBoxActivityView(t,e,n,r)},n}(Strava.Feed.PopoverBoxView),Strava.Feed.PopoverBoxPostView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.createInstance=function(t,e){return this.instance=new Strava.Feed.PopoverBoxPostView(t,e,null,null)},n.show=function(t,e,n,r,o){return null==r&&(r="comments"),null==o&&(o=!0),this.instance.render(t,e,n,r,!1,!1,o)},n}(Strava.Feed.PopoverBoxView)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.PrimaryPhotoFeedView=function(e){function n(t,e,r,o,i){this.el=t,this.activityId=e,this.polyline=r,this.primaryPhotoUrl=o,this.displayMap=null!=i?i:!0,n.__super__.constructor.call(this)}return t(n,e),n.prototype.render=function(){return this.$(".activity-primary-photo-container").css("background-image","url("+this.primaryPhotoUrl+")"),this.displayMap&&new Strava.Maps.PolylineOverlay(this.activityId,this.polyline,15,{}),this.$(".leaflet-zoom-animated").css({"-webkit-transform":"translate3d(0,0,0)"})},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.SlotsView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(t){return this.remaining=t.remaining,this.$el.find("li.media .card-entry-item").each(function(e){return function(n,r){var o;return o=new Strava.Feed.CardEntryItemView({model:t.slotted.at(n)}),o.attachToDom(r),e.addCardDismissHandler(n,o)}}(this))},n.prototype.addCardDismissHandler=function(t,e){return e.on("cardEntryItem:dismiss",function(n){return function(){return n.handleCardDismiss(t,e)}}(this))},n.prototype.renderCardAtIndex=function(t){var e,n;return n=this.remaining.shift(),n?(e=new Strava.Feed.CardEntryItemView({model:n}),this.addCardDismissHandler(t,e),e.$el.hide(),this.$("li.media").eq(t).append(e.render().el),e.$el.fadeIn(200)):this.$("li.media").eq(t).hide()},n.prototype.handleCardDismiss=function(t,e){return e.$el.fadeOut(200,function(n){return function(){return e.hide(),n.renderCardAtIndex(t),n.$("li.media").size()===n.$("li.media").filter(":hidden").size()?(n.$el.closest(".card-entry").find(".no-content").fadeIn(200),n.$el.closest(".card-entry").find("ul.list-media").hide()):void 0}}(this))},n}(Backbone.View)}.call(this),function(){Strava.module("Strava.Feed.Ui"),Strava.Feed.Ui=function(){function t(){}return t.commentsController=null,t.achievementsController=null,t.prepareUi=function(){return Strava.Feed.Ui.prepareCommentButton(),Strava.Ui.Global.prepareAutoresizingTextbox(),Strava.Feed.Ui.prepareExpandableAthletesList(),Strava.Feed.Ui.prepareExpandCommentsButton(),this.commentsController=new Strava.Lib.CommentsController,this.achievementsController=new Strava.Lib.AchievementsController},t.prepareCommentButton=function(){return jQuery("body").on("click",".js-inline-comments .add-comment, .btn-comment",function(){var t;return t=jQuery(this).parents(".feed-entry"),t.find(".social").removeClass("has-border"),t.find(".comments form").show().find("textarea").focus()})},t.prepareExpandableAthletesList=function(){return jQuery("body").on("click",".feed-entry .expand-all",function(){var t;return t=jQuery(this).parents().find(".feed-entry"),t.find("li.hidden").removeClass("hidden"),t.find("li.last-child").removeClass("last-child"),jQuery(this).remove(),t.find(".entry-footer-action").remove()})
},t.prepareExpandCommentsButton=function(){return jQuery("body").on("click",".comments .expand-all",function(){return jQuery(this).hide().next().find("li:not(:visible)").show()})},t}()}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Ui"),Strava.Ui.TabController=function(e){function n(t,e,r){null==e&&(e="ul.tabs"),null==r&&(r="#tab-contents"),this.el=e,this.tabs=t||[],this.contentSelector=r,this.bindToTabs(),n.__super__.constructor.call(this),this.tabClickHandler(function(t,e){return e.renderer.selected?void 0:t.showTab(e)})}return t(n,e),n.prototype.render=function(){var t;return t=_.find(this.tabs,function(t){return t.selected}),this.showTab(t)},n.prototype.unselectTabs=function(){var t,e,n,r,o;for(n=this.tabs,r=[],t=0,e=n.length;e>t;t++)o=n[t],o.renderer.unselect(),r.push(this.$(o.selector).removeClass("selected"));return r},n.prototype.selectTab=function(t){return t.renderer.select(),t.renderer.render(this.contentSelector),t.renderer.show(),this.$(t.selector).addClass("selected")},n.prototype.showTab=function(t){return this.unselectTabs(),this.selectTab(t)},n.prototype.tabClickHandler=function(t){return this.setOrGet("_tabClickHandler",t)},n.prototype.addTab=function(t,e,n){var r;return null==n&&(n=!1),r={selector:t,renderer:e,selected:n},this.tabs.push(r),e.on("close",function(t){return function(){return t.trigger("close")}}(this)),e.on("actionSuccess",function(t){return function(e){return t.trigger("actionSuccess",e)}}(this)),e.on("actionError",function(t){return function(e){return t.trigger("actionError",e)}}(this)),this.$(t).on("click",function(t){return function(){return t.tabClickHandler()(t,r)}}(this))},n.prototype.bindToTabs=function(){return jQuery.each(this.tabs,function(t){return function(e,n){return jQuery(n.selector).bind("click",function(){return t.tabClickHandler()(t,n)})}}(this))},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.CardEntryAction=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.label=function(){return this._action().text},n.prototype.actionState=function(){return"initial"===this.get("state")?"on":"off"},n.prototype.trackableTargetUrl=function(){return this._action().trackable_target_url},n.prototype.execute=function(){var t;return t={url:this._action().url,type:this._action().method},null!=this._hasData()&&(t.data=this._action().data),jQuery.ajax(t).done(function(t){return function(){return t._hasNext()?t._next():void 0}}(this))},n.prototype._action=function(){return this._getActionByState(this.get("state"))},n.prototype._getActionByState=function(t){return this._hasState(t)?this.get(t):null},n.prototype._hasData=function(){return this._action().hasOwnProperty("data")},n.prototype._hasState=function(t){return!!this.get(t)},n.prototype._hasNext=function(){switch(this.get("state")){case"initial":return this._hasState("completed")?!0:!1;case"completed":return this._hasState("initial")?!0:!1;default:return!1}},n.prototype._next=function(){switch(this.get("state")){case"initial":return this.set({state:"completed"});case"completed":return this.set({state:"initial"});default:return null}},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.CardEntryActions=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Strava.Models.CardEntryAction,n.prototype.hasActions=function(){return this.length>0},n}(Backbone.Collection)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.CardEntry=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(){return this.actionCollection=new Strava.Models.CardEntryActions(this.get("actions")),this.hasDismissAction()?this.dismiss=new Strava.Models.CardEntryAction(this.get("dismiss_action")):void 0},n.prototype.title=function(){return this.get("title")},n.prototype.subtitle=function(){return this.get("subtitle")},n.prototype.destinationUrl=function(){return this.get("destination_url")},n.prototype.avatarUrl=function(){return this.get("avatar").url},n.prototype.avatarShape=function(){return this.get("avatar").mask_shape},n.prototype.hasDismissAction=function(){return!!this.get("dismiss_action")},n.prototype.dismissAction=function(){return this.hasDismissAction()?this.dismiss:null},n.prototype.actions=function(){return this.actionCollection},n.prototype.avatar=function(){return this.avatarDeferred?this.avatarDeferred:(this.avatarDeferred=jQuery.Deferred(),this.avatar=new Image,this.avatar.src=this.avatarUrl(),this.avatar.alt=this.title(),this.avatar.onload=function(t){return function(){return t.avatarDeferred.resolve(t,t.avatar)}}(this),this.avatar.onerror=function(t){return function(){return t.avatarDeferred.reject(t,t.avatar)}}(this),this.avatarDeferred)},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.Cards=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Strava.Models.CardEntry,n}(Backbone.Collection)}.call(this);